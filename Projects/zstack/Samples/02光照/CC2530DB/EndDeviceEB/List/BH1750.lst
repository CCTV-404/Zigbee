###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         25/Jul/2015  11:07:28 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\Source\BH1750.c                               #
#    Command line       =  -f C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples #
#                          \02光照\CC2530DB\..\..\..\Tools\CC2530DB\f8wEndev. #
#                          cfg (-DCPU32MHZ -DROOT=__near_func                 #
#                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6         #
#                          -DMAC_CFG_RX_MAX=3) -f C:\ZStack-CC2530-2.5.1a\Pro #
#                          jects\zstack\Samples\02光照\CC2530DB\..\..\..\Tool #
#                          s\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO -DSECURE=0   #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00100000                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 C:\ZStack-CC2530-2.5.1a\Pro #
#                          jects\zstack\Samples\02光照\Source\BH1750.c -D     #
#                          NWK_AUTO_POLL -D ZTOOL_P1 -D MT_TASK -D            #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -D xPOWER_SAVING -lC C:\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\02光照\CC2530DB\EndDeviceEB\Lis #
#                          t\ -lA C:\ZStack-CC2530-2.5.1a\Projects\zstack\Sam #
#                          ples\02光照\CC2530DB\EndDeviceEB\List\             #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\CC2530DB\EndDeviceEB\Obj\ -e                  #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples #
#                          \02光照\CC2530DB\ -I C:\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\02光照\CC2530DB\..\Source\ -I   #
#                          C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\CC2530DB\..\..\..\ZMain\TI2530DB\ -I          #
#                          C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\CC2530DB\..\..\..\..\..\Components\hal\includ #
#                          e\ -I C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samp #
#                          les\02光照\CC2530DB\..\..\..\..\..\Components\hal\ #
#                          target\CC2530EB\ -I C:\ZStack-CC2530-2.5.1a\Projec #
#                          ts\zstack\Samples\02光照\CC2530DB\..\..\..\..\..\C #
#                          omponents\mac\include\ -I                          #
#                          C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\CC2530DB\..\..\..\..\..\Components\mac\high_l #
#                          evel\ -I C:\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02光照\CC2530DB\..\..\..\..\..\Components\m #
#                          ac\low_level\srf04\ -I C:\ZStack-CC2530-2.5.1a\Pro #
#                          jects\zstack\Samples\02光照\CC2530DB\..\..\..\..\. #
#                          .\Components\mac\low_level\srf04\single_chip\ -I   #
#                          C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\CC2530DB\..\..\..\..\..\Components\mt\ -I     #
#                          C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\CC2530DB\..\..\..\..\..\Components\osal\inclu #
#                          de\ -I C:\ZStack-CC2530-2.5.1a\Projects\zstack\Sam #
#                          ples\02光照\CC2530DB\..\..\..\..\..\Components\ser #
#                          vices\saddr\ -I C:\ZStack-CC2530-2.5.1a\Projects\z #
#                          stack\Samples\02光照\CC2530DB\..\..\..\..\..\Compo #
#                          nents\services\sdata\ -I                           #
#                          C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\CC2530DB\..\..\..\..\..\Components\stack\af\  #
#                          -I C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples #
#                          \02光照\CC2530DB\..\..\..\..\..\Components\stack\n #
#                          wk\ -I C:\ZStack-CC2530-2.5.1a\Projects\zstack\Sam #
#                          ples\02光照\CC2530DB\..\..\..\..\..\Components\sta #
#                          ck\sapi\ -I C:\ZStack-CC2530-2.5.1a\Projects\zstac #
#                          k\Samples\02光照\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\sec\ -I C:\ZStack-CC2530-2.5.1a\Projects\z #
#                          stack\Samples\02光照\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sys\ -I C:\ZStack-CC2530-2.5.1a\Projec #
#                          ts\zstack\Samples\02光照\CC2530DB\..\..\..\..\..\C #
#                          omponents\stack\zdo\ -I C:\ZStack-CC2530-2.5.1a\Pr #
#                          ojects\zstack\Samples\02光照\CC2530DB\..\..\..\..\ #
#                          ..\Components\zmac\ -I C:\ZStack-CC2530-2.5.1a\Pro #
#                          jects\zstack\Samples\02光照\CC2530DB\..\..\..\..\. #
#                          .\Components\zmac\f8w\ -Ohz --require_prototypes   #
#    List file          =  C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\CC2530DB\EndDeviceEB\List\BH1750.lst          #
#    Object file        =  C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02 #
#                          光照\CC2530DB\EndDeviceEB\Obj\BH1750.r51           #
#                                                                             #
#                                                                             #
###############################################################################

C:\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02光照\Source\BH1750.c
      1          /*******************************************************
      2          文件名:main.c
      3          版本号:v1.0
      4          创建日期:2013-10-23
      5          作者：楼D航
      6          主要函数描述：conversion 转换数据可供显示的ACII值
      7                        BH1750_Start() BH1750_Stop()分别给出启动和停止信号
      8                        BH1750_SendByte(BYTE dat)送一字节数据
      9                        BH1750_RecvByte()接受一个字节数据
     10                        Single_Write_BH1750(uchar REG_Address)写一个字节
     11                        Multiple_Read()连续读出内部数据
     12                        Init_BH1750()初始化BH1750
     13          ********************************************************/
     14          
     15          #include "BH1750.h"

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xd0
   \   union <unnamed> volatile __sfr _A_PSW
   \                     _A_PSW:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     16          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     17          BYTE    BUF[8];
   \                     BUF:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     18          uchar   ge, shi, bai, qian, wan;            //显示变量
   \                     `ge`:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     shi:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     bai:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     qian:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     wan:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     19          int     dis_data;
   \                     dis_data:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
     20          
     21          
     22          //*********************************************************

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     23          void conversion(uint temp_data)  //  数据转换出 个，十，百，千，万
   \                     conversion:
     24          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FC           MOV     R4,A
   \   000007   EB           MOV     A,R3
   \   000008   FD           MOV     R5,A
     25              wan=temp_data/10000+0x30 ;
   \   000009   EC           MOV     A,R4
   \   00000A   F8           MOV     R0,A
   \   00000B   ED           MOV     A,R5
   \   00000C   F9           MOV     R1,A
   \   00000D   7A10         MOV     R2,#0x10
   \   00000F   7B27         MOV     R3,#0x27
   \   000011   12....       LCALL   ?US_DIV_MOD
   \   000014   E8           MOV     A,R0
   \   000015   2430         ADD     A,#0x30
   \   000017   90....       MOV     DPTR,#wan
   \   00001A   12....       LCALL   ?Subroutine4 & 0xFFFF
     26              temp_data=temp_data%10000;   //取余运算
   \                     ??CrossCallReturnLabel_2:
   \   00001D   7A10         MOV     R2,#0x10
   \   00001F   7B27         MOV     R3,#0x27
   \   000021   12....       LCALL   ?US_DIV_MOD
   \   000024   8A..         MOV     ?V0 + 0,R2
   \   000026   8B..         MOV     ?V0 + 1,R3
   \   000028   AC..         MOV     R4,?V0 + 0
   \   00002A   AD..         MOV     R5,?V0 + 1
     27              qian=temp_data/1000+0x30 ;
   \   00002C   EC           MOV     A,R4
   \   00002D   F8           MOV     R0,A
   \   00002E   ED           MOV     A,R5
   \   00002F   F9           MOV     R1,A
   \   000030   7AE8         MOV     R2,#-0x18
   \   000032   7B03         MOV     R3,#0x3
   \   000034   12....       LCALL   ?US_DIV_MOD
   \   000037   E8           MOV     A,R0
   \   000038   2430         ADD     A,#0x30
   \   00003A   90....       MOV     DPTR,#qian
   \   00003D   12....       LCALL   ?Subroutine4 & 0xFFFF
     28              temp_data=temp_data%1000;    //取余运算
   \                     ??CrossCallReturnLabel_3:
   \   000040   7AE8         MOV     R2,#-0x18
   \   000042   7B03         MOV     R3,#0x3
   \   000044   12....       LCALL   ?US_DIV_MOD
   \   000047   8A..         MOV     ?V0 + 0,R2
   \   000049   8B..         MOV     ?V0 + 1,R3
   \   00004B   AC..         MOV     R4,?V0 + 0
   \   00004D   AD..         MOV     R5,?V0 + 1
     29              bai=temp_data/100+0x30   ;
   \   00004F   EC           MOV     A,R4
   \   000050   F8           MOV     R0,A
   \   000051   ED           MOV     A,R5
   \   000052   F9           MOV     R1,A
   \   000053   7A64         MOV     R2,#0x64
   \   000055   7B00         MOV     R3,#0x0
   \   000057   12....       LCALL   ?US_DIV_MOD
   \   00005A   E8           MOV     A,R0
   \   00005B   2430         ADD     A,#0x30
   \   00005D   90....       MOV     DPTR,#bai
   \   000060   12....       LCALL   ?Subroutine4 & 0xFFFF
     30              temp_data=temp_data%100;     //取余运算
   \                     ??CrossCallReturnLabel_4:
   \   000063   7A64         MOV     R2,#0x64
   \   000065   7B00         MOV     R3,#0x0
   \   000067   12....       LCALL   ?US_DIV_MOD
   \   00006A   8A..         MOV     ?V0 + 0,R2
   \   00006C   8B..         MOV     ?V0 + 1,R3
   \   00006E   AC..         MOV     R4,?V0 + 0
   \   000070   AD..         MOV     R5,?V0 + 1
     31              shi=temp_data/10+0x30    ;
   \   000072   EC           MOV     A,R4
   \   000073   F8           MOV     R0,A
   \   000074   ED           MOV     A,R5
   \   000075   F9           MOV     R1,A
   \   000076   7A0A         MOV     R2,#0xa
   \   000078   7B00         MOV     R3,#0x0
   \   00007A   12....       LCALL   ?US_DIV_MOD
   \   00007D   E8           MOV     A,R0
   \   00007E   2430         ADD     A,#0x30
   \   000080   90....       MOV     DPTR,#shi
   \   000083   12....       LCALL   ?Subroutine4 & 0xFFFF
     32              temp_data=temp_data%10;      //取余运算
     33              ge=temp_data+0x30; 	
   \                     ??CrossCallReturnLabel_5:
   \   000086   7A0A         MOV     R2,#0xa
   \   000088   7B00         MOV     R3,#0x0
   \   00008A   12....       LCALL   ?US_DIV_MOD
   \   00008D   EA           MOV     A,R2
   \   00008E   2430         ADD     A,#0x30
   \   000090   90....       MOV     DPTR,#`ge`
   \   000093   F0           MOVX    @DPTR,A
     34          }
   \   000094                REQUIRE ?Subroutine0
   \   000094                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   EC           MOV     A,R4
   \   000002   F8           MOV     R0,A
   \   000003   ED           MOV     A,R5
   \   000004   F9           MOV     R1,A
   \   000005   22           RET
     35          
     36          /**************************************
     37          延时5微秒
     38          不同的工作环境,需要调整此函数，注意时钟过快时需要修改
     39          当改用1T的MCU时,请调整此延时函数
     40          **************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     41          void Delay5us()
   \                     Delay5us:
     42          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
     43            asm("nop");//asm("nop");//asm("nop");asm("nop");
   \   000000   00           nop
     44            //asm("nop");asm("nop");asm("nop");asm("nop");
     45            //asm("nop");asm("nop");asm("nop");asm("nop");
     46            //asm("nop");asm("nop");asm("nop");asm("nop");
     47            //asm("nop");asm("nop");asm("nop");asm("nop");
     48            //asm("nop");asm("nop");asm("nop");asm("nop");
     49            //asm("nop");asm("nop");asm("nop");asm("nop");
     50           // asm("nop");asm("nop");asm("nop");asm("nop");
     51          }
   \   000001   02....       LJMP    ?BRET
     52          
     53          //毫秒延时**************************

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     54          void delay_nms(unsigned int k)	
   \                     delay_nms:
     55          {						
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
     56          unsigned int i,j;	
     57          for(i=0;i<k;i++)
   \   000009   75..00       MOV     ?V0 + 0,#0x0
   \   00000C   75..00       MOV     ?V0 + 1,#0x0
   \   00000F   8018         SJMP    ??delay_nms_0
     58          {
     59            for(j=0;j<200;j++)
   \                     ??delay_nms_1:
   \   000011   75..C8       MOV     ?V0 + 2,#-0x38
     60            {
     61              Delay5us();
   \                     ??delay_nms_2:
   \   000014                ; Setup parameters for call to function Delay5us
   \   000014   12....       LCALL   ??Delay5us?relay
     62            }	
   \   000017   15..         DEC     ?V0 + 2
   \   000019   E5..         MOV     A,?V0 + 2
   \   00001B   70F7         JNZ     ??delay_nms_2
     63          }
   \   00001D   E5..         MOV     A,?V0 + 0
   \   00001F   2401         ADD     A,#0x1
   \   000021   F5..         MOV     ?V0 + 0,A
   \   000023   E5..         MOV     A,?V0 + 1
   \   000025   3400         ADDC    A,#0x0
   \   000027   F5..         MOV     ?V0 + 1,A
   \                     ??delay_nms_0:
   \   000029   C3           CLR     C
   \   00002A   E5..         MOV     A,?V0 + 0
   \   00002C   9E           SUBB    A,R6
   \   00002D   E5..         MOV     A,?V0 + 1
   \   00002F   9F           SUBB    A,R7
   \   000030   40DF         JC      ??delay_nms_1
     64          }
   \   000032   7F03         MOV     R7,#0x3
   \   000034   02....       LJMP    ?BANKED_LEAVE_XDATA
     65          
     66          /**************************************
     67          延时5毫秒(STC90C52RC@12M)
     68          不同的工作环境,需要调整此函数
     69          当改用1T的MCU时,请调整此延时函数
     70          **************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     71          void Delay5ms()
   \                     Delay5ms:
     72          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
     73            int i=0;
     74            for(i=0;i<1000;i++)
   \   000005   7EE8         MOV     R6,#-0x18
   \   000007   7F03         MOV     R7,#0x3
     75              Delay5us();
   \                     ??Delay5ms_0:
   \   000009                ; Setup parameters for call to function Delay5us
   \   000009   12....       LCALL   ??Delay5us?relay
   \   00000C   EE           MOV     A,R6
   \   00000D   24FF         ADD     A,#-0x1
   \   00000F   1E           DEC     R6
   \   000010   EF           MOV     A,R7
   \   000011   34FF         ADDC    A,#-0x1
   \   000013   FF           MOV     R7,A
   \   000014   EE           MOV     A,R6
   \   000015   4F           ORL     A,R7
   \   000016   70F1         JNZ     ??Delay5ms_0
     76          }
   \   000018                REQUIRE ?Subroutine2
   \   000018                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
     77          
     78          /**************************************
     79          起始信号
     80          **************************************/
     81          //_Pragma("optimize=none")

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     82          void BH1750_Start()
   \                     BH1750_Start:
     83          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
     84              P1DIR |= (SCLBIT + SDABIT);
   \   000004   43FE88       ORL     0xfe,#0x88
     85              SDA = 1;                    //拉高数据线
   \   000007   D293         SETB    0x90.3
     86              SCL = 1;                    //拉高时钟线
   \   000009   D297         SETB    0x90.7
     87              Delay5us();                 //延时
   \   00000B                ; Setup parameters for call to function Delay5us
   \   00000B   12....       LCALL   ??Delay5us?relay
     88              SDA = 0;                    //产生下降沿
   \   00000E   C293         CLR     0x90.3
     89              Delay5us();                 //延时
   \   000010                ; Setup parameters for call to function Delay5us
   \   000010   12....       LCALL   ??Delay5us?relay
     90              SCL = 0;                    //拉低时钟线
   \   000013   C297         CLR     0x90.7
     91          }
   \   000015                REQUIRE ?Subroutine1
   \   000015                REQUIRE P1DIR
   \   000015                REQUIRE _A_P1
   \   000015                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
     92          
     93          /**************************************
     94          停止信号
     95          **************************************/
     96          //_Pragma("optimize=none")

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     97          void BH1750_Stop()
   \                     BH1750_Stop:
     98          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
     99              P1DIR |= (SCLBIT + SDABIT);
   \   000004   12....       LCALL   ?Subroutine3 & 0xFFFF
    100              SDA = 0;                    //拉低数据线
    101              SCL = 1;                    //拉高时钟线
    102              Delay5us();                 //延时
    103              SDA = 1;                    //产生上升沿
   \                     ??CrossCallReturnLabel_0:
   \   000007   D293         SETB    0x90.3
    104              Delay5us();                 //延时
   \   000009                ; Setup parameters for call to function Delay5us
   \   000009   12....       LCALL   ??Delay5us?relay
    105          }
   \   00000C   80..         SJMP    ?Subroutine1
   \   00000E                REQUIRE P1DIR
   \   00000E                REQUIRE _A_P1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   43FE88       ORL     0xfe,#0x88
   \   000003   C293         CLR     0x90.3
   \   000005   D297         SETB    0x90.7
   \   000007                ; Setup parameters for call to function Delay5us
   \   000007                ; Setup parameters for call to function Delay5us
   \   000007   12....       LCALL   ??Delay5us?relay
   \   00000A   22           RET
    106          
    107          /**************************************
    108          向IIC总线发送一个字节数据
    109          **************************************/
    110          _Pragma("optimize=none")

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    111          void BH1750_SendByte(BYTE dat)
   \                     BH1750_SendByte:
    112          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FF           MOV     R7,A
    113              P1DIR |= (SCLBIT + SDABIT);
   \   000007   43FE88       ORL     0xfe,#0x88
    114              BYTE i;
    115          
    116              for (i=0; i<8; i++)         //8位计数器
   \   00000A   7E00         MOV     R6,#0x0
   \                     ??BH1750_SendByte_0:
   \   00000C   EE           MOV     A,R6
   \   00000D   C3           CLR     C
   \   00000E   9408         SUBB    A,#0x8
   \   000010   5015         JNC     ??BH1750_SendByte_1
    117              {
    118                  dat <<= 1;              //移出数据的最高位
   \   000012   EF           MOV     A,R7
   \   000013   C3           CLR     C
   \   000014   33           RLC     A
   \   000015   FF           MOV     R7,A
    119                  SDA = CY;               //送数据口
   \   000016   A2D7         MOV     C,0xd0.7
   \   000018   9293         MOV     0x90.3,C
    120                  SCL = 1;                //拉高时钟线
   \   00001A   D297         SETB    0x90.7
    121                  Delay5us();             //延时
   \   00001C                ; Setup parameters for call to function Delay5us
   \   00001C   12....       LCALL   ??Delay5us?relay
    122                  SCL = 0;                //拉低时钟线
   \   00001F   C297         CLR     0x90.7
    123                  Delay5us();             //延时
   \   000021                ; Setup parameters for call to function Delay5us
   \   000021   12....       LCALL   ??Delay5us?relay
    124              }
   \   000024   0E           INC     R6
   \   000025   80E5         SJMP    ??BH1750_SendByte_0
    125              SCL = 1;                    //拉高时钟线
   \                     ??BH1750_SendByte_1:
   \   000027   D297         SETB    0x90.7
    126              P1DIR &= ~SDABIT;                  //改变SDA方向
   \   000029   53FEF7       ANL     0xfe,#0xf7
    127              Delay5us();                 //延时
   \   00002C                ; Setup parameters for call to function Delay5us
   \   00002C   12....       LCALL   ??Delay5us?relay
    128              CY = SDA;                   //读应答信号
   \   00002F   A293         MOV     C,0x90.3
   \   000031   92D7         MOV     0xd0.7,C
    129              SCL = 0;                    //拉低时钟线
   \   000033   C297         CLR     0x90.7
    130              Delay5us();                 //延时
   \   000035                ; Setup parameters for call to function Delay5us
   \   000035   12....       LCALL   ??Delay5us?relay
    131              P1DIR |= (SCLBIT + SDABIT);
   \   000038   43FE88       ORL     0xfe,#0x88
    132          }
   \   00003B   7F01         MOV     R7,#0x1
   \   00003D   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000040                REQUIRE P1DIR
   \   000040                REQUIRE _A_P1
   \   000040                REQUIRE _A_PSW
    133          
    134          /**************************************
    135          从IIC总线接收一个字节数据
    136          **************************************/
    137          //_Pragma("optimize=none")

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    138          BYTE BH1750_RecvByte()
   \                     BH1750_RecvByte:
    139          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    140              P1DIR |= SCLBIT;
   \   000005   43FE80       ORL     0xfe,#0x80
    141              P1DIR &= ~SDABIT;
   \   000008   53FEF7       ANL     0xfe,#0xf7
    142              BYTE i;
    143              BYTE dat = 0;
   \   00000B   7E00         MOV     R6,#0x0
    144          
    145              SDA = 1;                    //使能内部上拉,准备读取数据,
   \   00000D   D293         SETB    0x90.3
    146              for (i=0; i<8; i++)         //8位计数器
   \   00000F   7F08         MOV     R7,#0x8
    147              {
    148                  dat <<= 1;
    149                  SCL = 1;                //拉高时钟线
   \                     ??BH1750_RecvByte_0:
   \   000011   D297         SETB    0x90.7
    150                  Delay5us();             //延时
   \   000013                ; Setup parameters for call to function Delay5us
   \   000013   12....       LCALL   ??Delay5us?relay
    151                  dat |= SDA;             //读数据
   \   000016   A293         MOV     C,0x90.3
   \   000018   E4           CLR     A
   \   000019   33           RLC     A
   \   00001A   F8           MOV     R0,A
   \   00001B   EE           MOV     A,R6
   \   00001C   33           RLC     A
   \   00001D   48           ORL     A,R0
   \   00001E   FE           MOV     R6,A
    152                  SCL = 0;                //拉低时钟线
   \   00001F   C297         CLR     0x90.7
    153                  Delay5us();             //延时
   \   000021                ; Setup parameters for call to function Delay5us
   \   000021   12....       LCALL   ??Delay5us?relay
    154              }
   \   000024   1F           DEC     R7
   \   000025   EF           MOV     A,R7
   \   000026   70E9         JNZ     ??BH1750_RecvByte_0
    155              P1DIR |= (SCLBIT + SDABIT);
   \   000028   43FE88       ORL     0xfe,#0x88
    156          
    157              return dat;
   \   00002B   EE           MOV     A,R6
   \   00002C   F9           MOV     R1,A
   \   00002D   02....       LJMP    ?Subroutine2 & 0xFFFF
   \   000030                REQUIRE P1DIR
   \   000030                REQUIRE _A_P1
    158          
    159          }
    160          
    161          //*********************************
    162          //_Pragma("optimize=none")

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    163          void Single_Write_BH1750(uchar REG_Address)   
   \                     Single_Write_BH1750:
    164          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    165              BH1750_Start();                  //起始信号
   \   000007                ; Setup parameters for call to function BH1750_Start
   \   000007   12....       LCALL   ??BH1750_Start?relay
    166              BH1750_SendByte(SlaveAddress);   //发送设备地址+写信号
   \   00000A                ; Setup parameters for call to function BH1750_SendByte
   \   00000A   7946         MOV     R1,#0x46
   \   00000C   12....       LCALL   ??BH1750_SendByte?relay
    167              BH1750_SendByte(REG_Address);    //内部寄存器地址，
   \   00000F                ; Setup parameters for call to function BH1750_SendByte
   \   00000F   EE           MOV     A,R6
   \   000010   F9           MOV     R1,A
   \   000011   12....       LCALL   ??BH1750_SendByte?relay
    168            //  BH1750_SendByte(REG_data);       //内部寄存器数据，
    169              BH1750_Stop();                   //发送停止信号
   \   000014                ; Setup parameters for call to function BH1750_Stop
   \   000014   12....       LCALL   ??BH1750_Stop?relay
    170          }
   \   000017   02....       LJMP    ?Subroutine2 & 0xFFFF
    171          
    172          //********单字节读取***************
    173          //_Pragma("optimize=none")
    174          /*uchar Single_Read_BH1750(uchar REG_Address)
    175          {  uchar REG_data;
    176              BH1750_Start();                          //起始信号
    177              BH1750_SendByte(SlaveAddress);           //发送设备地址+写信号
    178              BH1750_SendByte(REG_Address);                   //发送存储单元地址，从0开始	
    179              BH1750_Start();                          //起始信号
    180              BH1750_SendByte(SlaveAddress+1);         //发送设备地址+读信号
    181              REG_data=BH1750_RecvByte();              //读出寄存器数据
    182          	BH1750_SendACK(1);
    183          	BH1750_Stop();                           //停止信号
    184              return REG_data;
    185          }*/
    186          
    187          //*********************************************************
    188          //
    189          //连续读出BH1750内部数据
    190          //
    191          //*********************************************************
    192          //_Pragma("optimize=none")

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    193          void Multiple_Read()
   \                     Multiple_Read:
    194          {   uchar i;	
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    195              BH1750_Start();                          //起始信号
   \   000005                ; Setup parameters for call to function BH1750_Start
   \   000005   12....       LCALL   ??BH1750_Start?relay
    196              BH1750_SendByte(SlaveAddress+1);         //发送设备地址+读信号
   \   000008                ; Setup parameters for call to function BH1750_SendByte
   \   000008   7947         MOV     R1,#0x47
   \   00000A   12....       LCALL   ??BH1750_SendByte?relay
    197          	
    198             for (i=0; i<3; i++)                      //连续读取2个地址数据，存储中BUF
   \   00000D   7E00         MOV     R6,#0x0
    199              {
    200                  BUF[i] = BH1750_RecvByte();          //BUF[0]存储0x32地址中的数据
   \                     ??Multiple_Read_0:
   \   00000F                ; Setup parameters for call to function BH1750_RecvByte
   \   00000F   12....       LCALL   ??BH1750_RecvByte?relay
   \   000012   8E..         MOV     ?V0 + 0,R6
   \   000014   74..         MOV     A,#BUF & 0xff
   \   000016   25..         ADD     A,?V0 + 0
   \   000018   F582         MOV     DPL,A
   \   00001A   74..         MOV     A,#(BUF >> 8) & 0xff
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   F583         MOV     DPH,A
   \   000020   E9           MOV     A,R1
   \   000021   F0           MOVX    @DPTR,A
    201                  if (i == 3)
    202                  {
    203                     P1DIR |= (SCLBIT + SDABIT);
    204                     SDA = 1;                  //写应答信号
    205                     SCL = 1;                    //拉高时钟线
    206                     Delay5us();                 //延时
    207                     SCL = 0;                    //拉低时钟线
    208                     Delay5us();                 //延时
    209                  }
    210                  else
    211                  {		
    212                     P1DIR |= (SCLBIT + SDABIT);
   \   000022   12....       LCALL   ?Subroutine3 & 0xFFFF
    213                     SDA = 0;                  //写应答信号
    214                     SCL = 1;                    //拉高时钟线
    215                     Delay5us();                 //延时
    216                     SCL = 0;                    //拉低时钟线
   \                     ??CrossCallReturnLabel_1:
   \   000025   C297         CLR     0x90.7
    217                     Delay5us();                 //延时
   \   000027                ; Setup parameters for call to function Delay5us
   \   000027   12....       LCALL   ??Delay5us?relay
    218                 }
    219             }
   \   00002A   0E           INC     R6
   \   00002B   EE           MOV     A,R6
   \   00002C   C3           CLR     C
   \   00002D   9403         SUBB    A,#0x3
   \   00002F   40DE         JC      ??Multiple_Read_0
    220          
    221              BH1750_Stop();                          //停止信号
   \   000031                ; Setup parameters for call to function BH1750_Stop
   \   000031   12....       LCALL   ??BH1750_Stop?relay
    222              Delay5ms();
   \   000034                ; Setup parameters for call to function Delay5ms
   \   000034   12....       LCALL   ??Delay5ms?relay
    223          }
   \   000037   02....       LJMP    ?Subroutine0 & 0xFFFF
   \   00003A                REQUIRE P1DIR
   \   00003A                REQUIRE _A_P1
    224          
    225          
    226          //_Pragma("optimize=none")

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    227          void Init_BH1750()
   \                     Init_BH1750:
    228          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    229             Single_Write_BH1750(0x08);
   \   000004                ; Setup parameters for call to function Single_Write_BH1750
   \   000004   7908         MOV     R1,#0x8
   \   000006   12....       LCALL   ??Single_Write_BH1750?relay
    230          }
   \   000009   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??conversion?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    conversion

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Delay5us?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Delay5us

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??delay_nms?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    delay_nms

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Delay5ms?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Delay5ms

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??BH1750_Start?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    BH1750_Start

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??BH1750_Stop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    BH1750_Stop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??BH1750_SendByte?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    BH1750_SendByte

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??BH1750_RecvByte?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    BH1750_RecvByte

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Single_Write_BH1750?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Single_Write_BH1750

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Multiple_Read?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Multiple_Read

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Init_BH1750?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Init_BH1750
    231          

   Maximum stack usage in bytes:

     Function                 ISTACK PSTACK XSTACK
     --------                 ------ ------ ------
     BH1750_RecvByte              0      0     19
       -> Delay5us                0      0     18
       -> Delay5us                0      0     18
     BH1750_SendByte              0      0     19
       -> Delay5us                0      0     18
       -> Delay5us                0      0     18
       -> Delay5us                0      0     18
       -> Delay5us                0      0     18
     BH1750_Start                 2      0     10
       -> Delay5us                4      0      0
       -> Delay5us                4      0      0
     BH1750_Stop                  2      0     10
       -> Delay5us                4      0      0
       -> Delay5us                4      0      0
     Delay5ms                     0      0     19
       -> Delay5us                0      0     18
     Delay5us                     0      0     11
     Init_BH1750                  2      0      0
       -> Single_Write_BH1750     4      0      0
     Multiple_Read                1      0     10
       -> BH1750_Start            0      0     20
       -> BH1750_SendByte         0      0     20
       -> BH1750_RecvByte         0      0     20
       -> Delay5us                0      0     20
       -> Delay5us                0      0     20
       -> BH1750_Stop             0      0     20
       -> Delay5ms                0      0     20
     Single_Write_BH1750          0      0      9
       -> BH1750_Start            0      0     18
       -> BH1750_SendByte         0      0     18
       -> BH1750_SendByte         0      0     18
       -> BH1750_Stop             0      0     18
     conversion                   0      0     10
     delay_nms                    0      0     11
       -> Delay5us                0      0     22


   Segment part sizes:

     Function/Label              Bytes
     --------------              -----
     _A_P1                          1
     _A_PSW                         1
     P1DIR                          1
     BUF                            8
     ge                             1
     shi                            1
     bai                            1
     qian                           1
     wan                            1
     dis_data                       2
     conversion                   148
     ?Subroutine0                   5
     ?Subroutine4                   6
     Delay5us                       4
     delay_nms                     55
     Delay5ms                      24
     ?Subroutine2                   5
     BH1750_Start                  21
     ?Subroutine1                   7
     BH1750_Stop                   14
     ?Subroutine3                  11
     BH1750_SendByte               64
     BH1750_RecvByte               48
     Single_Write_BH1750           26
     Multiple_Read                 58
     Init_BH1750                   12
     ??conversion?relay             6
     ??Delay5us?relay               6
     ??delay_nms?relay              6
     ??Delay5ms?relay               6
     ??BH1750_Start?relay           6
     ??BH1750_Stop?relay            6
     ??BH1750_SendByte?relay        6
     ??BH1750_RecvByte?relay        6
     ??Single_Write_BH1750?relay    6
     ??Multiple_Read?relay          6
     ??Init_BH1750?relay            6

 
 508 bytes in segment BANKED_CODE
  66 bytes in segment BANK_RELAYS
   3 bytes in segment SFR_AN
  15 bytes in segment XDATA_Z
 
 574 bytes of CODE  memory
   0 bytes of DATA  memory (+ 3 bytes shared)
  15 bytes of XDATA memory

Errors: none
Warnings: none
