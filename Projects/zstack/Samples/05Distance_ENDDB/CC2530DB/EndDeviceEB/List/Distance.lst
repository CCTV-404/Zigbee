###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         19/Feb/2014  10:53:13 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Users\OurEDA\Documents\Tencent                  #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\Source\Distance.c                         #
#    Command line       =  -f "C:\Users\OurEDA\Documents\Tencent              #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\Tools\CC2530DB\f8wEndev #
#                          .cfg" (-DCPU32MHZ -DROOT=__near_func               #
#                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6         #
#                          -DMAC_CFG_RX_MAX=3) -f "C:\Users\OurEDA\Documents\ #
#                          Tencent Files\1534143789\FileRecv\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ #
#                          05Distance_ENDDB\CC2530DB\..\..\..\Tools\CC2530DB\ #
#                          f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0             #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Users\OurEDA\Documents\ #
#                          Tencent Files\1534143789\FileRecv\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ #
#                          05Distance_ENDDB\Source\Distance.c" -D             #
#                          NWK_AUTO_POLL -D ZTOOL_P1 -D MT_TASK -D            #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -D xPOWER_SAVING -lC "C:\Users\OurEDA\Documents\Te #
#                          ncent Files\1534143789\FileRecv\ZStack-CC2530-2.5. #
#                          1a\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\05 #
#                          Distance_ENDDB\CC2530DB\EndDeviceEB\List\" -lA     #
#                          "C:\Users\OurEDA\Documents\Tencent                 #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\EndDeviceEB\List\"               #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          "C:\Users\OurEDA\Documents\Tencent                 #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\EndDeviceEB\Obj\" -e             #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "C:\Users\OurEDA\Documents\Tencent              #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\" -I "C:\Users\OurEDA\Documents\ #
#                          Tencent Files\1534143789\FileRecv\ZStack-CC2530-2. #
#                          5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\ #
#                          05Distance_ENDDB\CC2530DB\..\Source\" -I           #
#                          "C:\Users\OurEDA\Documents\Tencent                 #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\ZMain\TI2530DB\" -I     #
#                          "C:\Users\OurEDA\Documents\Tencent                 #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\hal\in #
#                          clude\" -I "C:\Users\OurEDA\Documents\Tencent      #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\hal\ta #
#                          rget\CC2530EB\" -I "C:\Users\OurEDA\Documents\Tenc #
#                          ent Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a #
#                          \ZStack-CC2530-2.5.1a\Projects\zstack\Samples\05Di #
#                          stance_ENDDB\CC2530DB\..\..\..\..\..\Components\ma #
#                          c\include\" -I "C:\Users\OurEDA\Documents\Tencent  #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\mac\hi #
#                          gh_level\" -I "C:\Users\OurEDA\Documents\Tencent   #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\mac\lo #
#                          w_level\srf04\" -I "C:\Users\OurEDA\Documents\Tenc #
#                          ent Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a #
#                          \ZStack-CC2530-2.5.1a\Projects\zstack\Samples\05Di #
#                          stance_ENDDB\CC2530DB\..\..\..\..\..\Components\ma #
#                          c\low_level\srf04\single_chip\" -I                 #
#                          "C:\Users\OurEDA\Documents\Tencent                 #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\mt\"   #
#                          -I "C:\Users\OurEDA\Documents\Tencent              #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\osal\i #
#                          nclude\" -I "C:\Users\OurEDA\Documents\Tencent     #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\servic #
#                          es\saddr\" -I "C:\Users\OurEDA\Documents\Tencent   #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\servic #
#                          es\sdata\" -I "C:\Users\OurEDA\Documents\Tencent   #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\stack\ #
#                          af\" -I "C:\Users\OurEDA\Documents\Tencent         #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\stack\ #
#                          nwk\" -I "C:\Users\OurEDA\Documents\Tencent        #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\stack\ #
#                          sapi\" -I "C:\Users\OurEDA\Documents\Tencent       #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\stack\ #
#                          sec\" -I "C:\Users\OurEDA\Documents\Tencent        #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\stack\ #
#                          sys\" -I "C:\Users\OurEDA\Documents\Tencent        #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\stack\ #
#                          zdo\" -I "C:\Users\OurEDA\Documents\Tencent        #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\zmac\" #
#                           -I "C:\Users\OurEDA\Documents\Tencent             #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\..\..\..\..\..\Components\zmac\f #
#                          8w\" -Ohz                                          #
#    List file          =  C:\Users\OurEDA\Documents\Tencent                  #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\EndDeviceEB\List\Distance.lst    #
#    Object file        =  C:\Users\OurEDA\Documents\Tencent                  #
#                          Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZSt #
#                          ack-CC2530-2.5.1a\Projects\zstack\Samples\05Distan #
#                          ce_ENDDB\CC2530DB\EndDeviceEB\Obj\Distance.r51     #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\OurEDA\Documents\Tencent Files\1534143789\FileRecv\ZStack-CC2530-2.5.1a\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\05Distance_ENDDB\Source\Distance.c
      1          /******************************************************************************
      2            Filename:       Distance.c
      3            Revised:        $Date: 2012-03-07 01:04:58 -0800 (Wed, 07 Mar 2012) $
      4            Revision:       $Revision: 29656 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License"). You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product. Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          ******************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends "Hello World" to another "Generic"
     45            application every 5 seconds.  The application will also
     46            receives "Hello World" packets.
     47          
     48            The "Hello World" messages are sent/received as MSG type message.
     49          
     50            This applications doesn't have a profile, so it handles everything
     51            directly - itself.
     52          
     53            Key control:
     54              SW1:
     55              SW2:  initiates end device binding
     56              SW3:
     57              SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include "OSAL.h"
     64          #include "AF.h"
     65          #include "ZDApp.h"
     66          #include "ZDObject.h"
     67          #include "ZDProfile.h"
     68          
     69          #include "Distance.h"
     70          #include "DebugTrace.h"
     71          
     72          #include "HC_SR04.h"

   \                                 In  segment SFR_AN, at 0x8a
   \   unsigned char volatile __sfr P1IFG
   \                     P1IFG:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xe2
   \   unsigned char volatile __sfr T1CNTL
   \                     T1CNTL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xe3
   \   unsigned char volatile __sfr T1CNTH
   \                     T1CNTH:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xe8
   \   union <unnamed> volatile __sfr _A_IRCON2
   \                     _A_IRCON2:
   \   000000                DS 1
     73          
     74          #if !defined( WIN32 )
     75            #include "OnBoard.h"
     76          #endif
     77          
     78          /* HAL */
     79          #include "hal_lcd.h"
     80          #include "hal_led.h"
     81          #include "hal_key.h"
     82          #include "hal_uart.h"
     83          
     84          /* RTOS */
     85          #if defined( IAR_ARMCM3_LM )
     86          #include "RTOS_App.h"
     87          #endif  
     88          
     89          /*********************************************************************
     90           * MACROS
     91           */
     92          
     93          /*********************************************************************
     94           * CONSTANTS
     95           */
     96          
     97          /*********************************************************************
     98           * TYPEDEFS
     99           */
    100          
    101          /*********************************************************************
    102           * GLOBAL VARIABLES
    103           */
    104          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    105          const cId_t Distance_ClusterList[Distance_MAX_CLUSTERS] =
   \                     Distance_ClusterList:
   \   000000   0500         DW 5
    106          {
    107            Distance_CLUSTERID
    108          };
    109          

   \                                 In  segment XDATA_ROM_C, align 1
    110          const SimpleDescriptionFormat_t Distance_SimpleDesc =
   \                     Distance_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   01           DB 1
   \   000007   ....         DW Distance_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW Distance_ClusterList
    111          {
    112            Distance_ENDPOINT,              //  int Endpoint;
    113            Distance_PROFID,                //  uint16 AppProfId[2];
    114            Distance_DEVICEID,              //  uint16 AppDeviceId[2];
    115            Distance_DEVICE_VERSION,        //  int   AppDevVer:4;
    116            Distance_FLAGS,                 //  int   AppFlags:4;
    117            Distance_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    118            (cId_t *)Distance_ClusterList,  //  byte *pAppInClusterList;
    119            Distance_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    120            (cId_t *)Distance_ClusterList   //  byte *pAppInClusterList;
    121          };
    122          
    123          // This is the Endpoint/Interface description.  It is defined here, but
    124          // filled-in in Distance_Init().  Another way to go would be to fill
    125          // in the structure here and make it a "const" (in code space).  The
    126          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    127          endPointDesc_t Distance_epDesc;
   \                     Distance_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    128          
    129          /*********************************************************************
    130           * EXTERNAL VARIABLES
    131           */
    132          
    133          /*********************************************************************
    134           * EXTERNAL FUNCTIONS
    135           */
    136          
    137          /*********************************************************************
    138           * LOCAL VARIABLES
    139           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    140          byte Distance_TaskID;   // Task ID for internal task/event processing
   \                     Distance_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    141                                    // This variable will be received when
    142                                    // Distance_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          devStates_t Distance_NwkState;
   \                     Distance_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    144          
    145          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          byte Distance_TransID;  // This is the unique message ID (counter)
   \                     Distance_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    147          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    148          afAddrType_t Distance_DstAddr;
   \                     Distance_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    149          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          byte DistanceMeasurement_TaskID;
   \                     DistanceMeasurement_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    151          devStates_t DistanceMeasurement_NwkState;
   \                     DistanceMeasurement_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          byte DistanceMeasurement_TransID;
   \                     DistanceMeasurement_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          float fDistance;
   \                     fDistance:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    155          float  distance;
   \                     distance:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          float s;
   \                     `s`:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    157          int dis;
   \                     dis:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    158          uint H;
   \                     H:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    159          uint H1;
   \                     H1:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    160          uint L;
   \                     L:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    161          uint L1;
   \                     L1:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    162          
    163          /*********************************************************************
    164           * LOCAL FUNCTIONS
    165           */
    166          static void Distance_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    167          static void Distance_HandleKeys( byte shift, byte keys );
    168          static void Distance_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    169          static void Distance_SendTheMessage( void );
    170          
    171          #if defined( IAR_ARMCM3_LM )
    172          static void Distance_ProcessRtosMessage( void );
    173          #endif
    174          
    175          /*********************************************************************
    176           * NETWORK LAYER CALLBACKS
    177           */
    178          
    179          /*********************************************************************
    180           * PUBLIC FUNCTIONS
    181           */
    182          
    183          /*********************************************************************
    184           * @fn      Distance_Init
    185           *
    186           * @brief   Initialization function for the Generic App Task.
    187           *          This is called during initialization and should contain
    188           *          any application specific initialization (ie. hardware
    189           *          initialization/setup, table initialization, power up
    190           *          notificaiton ... ).
    191           *
    192           * @param   task_id - the ID assigned by OSAL.  This ID should be
    193           *                    used to send messages and set timers.
    194           *
    195           * @return  none
    196           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    197          void Distance_Init( uint8 task_id )
   \                     Distance_Init:
    198          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    199            Distance_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#Distance_TaskID
   \   000009   F0           MOVX    @DPTR,A
    200            Distance_NwkState = DEV_INIT;
   \   00000A   90....       MOV     DPTR,#Distance_NwkState
   \   00000D   7401         MOV     A,#0x1
   \   00000F   F0           MOVX    @DPTR,A
    201            Distance_TransID = 0;
   \   000010   90....       MOV     DPTR,#Distance_TransID
   \   000013   E4           CLR     A
   \   000014   F0           MOVX    @DPTR,A
    202          
    203            // Device hardware initialization can be added here or in main() (Zmain.c).
    204            // If the hardware is application specific - add it here.
    205            // If the hardware is other parts of the device add it in main().
    206          
    207            Distance_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   000015   90....       MOV     DPTR,#Distance_DstAddr + 8
   \   000018   F0           MOVX    @DPTR,A
    208            Distance_DstAddr.endPoint = 0;
   \   000019   A3           INC     DPTR
   \   00001A   F0           MOVX    @DPTR,A
    209            Distance_DstAddr.addr.shortAddr = 0;
   \   00001B   90....       MOV     DPTR,#Distance_DstAddr
   \   00001E   F0           MOVX    @DPTR,A
   \   00001F   A3           INC     DPTR
   \   000020   F0           MOVX    @DPTR,A
    210          
    211            // Fill out the endpoint description.
    212            Distance_epDesc.endPoint = Distance_ENDPOINT;
   \   000021   90....       MOV     DPTR,#Distance_epDesc
   \   000024   740A         MOV     A,#0xa
   \   000026   F0           MOVX    @DPTR,A
    213            Distance_epDesc.task_id = &Distance_TaskID;
   \   000027   A3           INC     DPTR
   \   000028   74..         MOV     A,#Distance_TaskID & 0xff
   \   00002A   F0           MOVX    @DPTR,A
   \   00002B   A3           INC     DPTR
   \   00002C   74..         MOV     A,#(Distance_TaskID >> 8) & 0xff
   \   00002E   F0           MOVX    @DPTR,A
    214            Distance_epDesc.simpleDesc
    215                      = (SimpleDescriptionFormat_t *)&Distance_SimpleDesc;
   \   00002F   A3           INC     DPTR
   \   000030   74..         MOV     A,#Distance_SimpleDesc & 0xff
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   74..         MOV     A,#(Distance_SimpleDesc >> 8) & 0xff
   \   000036   F0           MOVX    @DPTR,A
    216            Distance_epDesc.latencyReq = noLatencyReqs;
   \   000037   A3           INC     DPTR
   \   000038   E4           CLR     A
   \   000039   F0           MOVX    @DPTR,A
    217          
    218            // Register the endpoint description with the AF
    219            afRegister( &Distance_epDesc );
   \   00003A                ; Setup parameters for call to function afRegister
   \   00003A   7A..         MOV     R2,#Distance_epDesc & 0xff
   \   00003C   7B..         MOV     R3,#(Distance_epDesc >> 8) & 0xff
   \   00003E   12....       LCALL   ??afRegister?relay
    220          
    221            // Register for all key events - This app will handle all key events
    222            RegisterForKeys( Distance_TaskID );
   \   000041                ; Setup parameters for call to function RegisterForKeys
   \   000041   90....       MOV     DPTR,#Distance_TaskID
   \   000044   E0           MOVX    A,@DPTR
   \   000045   F9           MOV     R1,A
   \   000046   12....       LCALL   ??RegisterForKeys?relay
    223          
    224            // Update the display
    225          #if defined ( LCD_SUPPORTED )
    226            HalLcdWriteString( "Distance", HAL_LCD_LINE_1 );
   \   000049                ; Setup parameters for call to function HalLcdWriteString
   \   000049   7901         MOV     R1,#0x1
   \   00004B   7A..         MOV     R2,#`?<Constant "Distance">` & 0xff
   \   00004D   7B..         MOV     R3,#(`?<Constant "Distance">` >> 8) & 0xff
   \   00004F   12....       LCALL   ??HalLcdWriteString?relay
    227          #endif
    228          
    229            ZDO_RegisterForZDOMsg( Distance_TaskID, End_Device_Bind_rsp );
   \   000052                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000052   7A20         MOV     R2,#0x20
   \   000054   7B80         MOV     R3,#-0x80
   \   000056   90....       MOV     DPTR,#Distance_TaskID
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F9           MOV     R1,A
   \   00005B   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    230            ZDO_RegisterForZDOMsg( Distance_TaskID, Match_Desc_rsp );
   \   00005E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00005E   7A06         MOV     R2,#0x6
   \   000060   7B80         MOV     R3,#-0x80
   \   000062   90....       MOV     DPTR,#Distance_TaskID
   \   000065   E0           MOVX    A,@DPTR
   \   000066   F9           MOV     R1,A
   \   000067   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    231          
    232          #if defined( IAR_ARMCM3_LM )
    233            // Register this task with RTOS task initiator
    234            RTOS_RegisterApp( task_id, Distance_RTOS_MSG_EVT );
    235          #endif
    236          }
   \   00006A                REQUIRE ?Subroutine0
   \   00006A                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    237          
    238          /*********************************************************************
    239           * @fn      Distance_ProcessEvent
    240           *
    241           * @brief   Generic Application Task event processor.  This function
    242           *          is called to process all events for the task.  Events
    243           *          include timers, messages and any other user defined events.
    244           *
    245           * @param   task_id  - The OSAL assigned task ID.
    246           * @param   events - events to process.  This is a bit map and can
    247           *                   contain more than one event.
    248           *
    249           * @return  none
    250           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    251          uint16 Distance_ProcessEvent( uint8 task_id, uint16 events )
   \                     Distance_ProcessEvent:
    252          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 24
   \   000005   74E8         MOV     A,#-0x18
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 4,R2
   \   00000C   8B..         MOV     ?V0 + 5,R3
    253            afIncomingMSGPacket_t *MSGpkt;
    254            afDataConfirm_t *afDataConfirm;
    255          
    256            // Data Confirmation message fields
    257            byte sentEP;
    258            ZStatus_t sentStatus;
    259            byte sentTransID;       // This should match the value sent
    260            (void)task_id;  // Intentionally unreferenced parameter
    261          
    262            if ( events & SYS_EVENT_MSG )
   \   00000E   EB           MOV     A,R3
   \   00000F   5480         ANL     A,#0x80
   \   000011   7003         JNZ     $+5
   \   000013   02....       LJMP    ??Distance_ProcessEvent_0 & 0xFFFF
    263            {
    264              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( Distance_TaskID );
   \   000016                ; Setup parameters for call to function osal_msg_receive
   \   000016   801E         SJMP    ??Distance_ProcessEvent_1
    265              while ( MSGpkt )
    266              {
    267                switch ( MSGpkt->hdr.event )
    268                {
    269                  case ZDO_CB_MSG:
    270                    Distance_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    271                    break;
    272          
    273                  case KEY_CHANGE:
    274                    Distance_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    275                    break;
    276          
    277                  case AF_DATA_CONFIRM_CMD:
    278                    // This message is received as a confirmation of a data packet sent.
    279                    // The status is of ZStatus_t type [defined in ZComDef.h]
    280                    // The message fields are defined in AF.h
    281                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    282                    sentEP = afDataConfirm->endpoint;
    283                    sentStatus = afDataConfirm->hdr.status;
    284                    sentTransID = afDataConfirm->transID;
    285                    (void)sentEP;
    286                    (void)sentTransID;
    287          
    288                    // Action taken when confirmation is received.
    289                    if ( sentStatus != ZSuccess )
    290                    {
    291                      // The data wasn't delivered -- Do something
    292                    }
    293                    break;
    294          
    295                  case AF_INCOMING_MSG_CMD:
    296                    Distance_MessageMSGCB( MSGpkt );
    297                    break;
    298          
    299                  case ZDO_STATE_CHANGE:
    300                    Distance_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??Distance_ProcessEvent_2:
   \   000018   A3           INC     DPTR
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   90....       MOV     DPTR,#Distance_NwkState
   \   00001D   F0           MOVX    @DPTR,A
    301                    if ( (Distance_NwkState == DEV_ZB_COORD)
    302                        || (Distance_NwkState == DEV_ROUTER)
    303                        || (Distance_NwkState == DEV_END_DEVICE) )
   \   00001E   6409         XRL     A,#0x9
   \   000020   600A         JZ      ??Distance_ProcessEvent_3
   \   000022   E0           MOVX    A,@DPTR
   \   000023   6407         XRL     A,#0x7
   \   000025   6005         JZ      ??Distance_ProcessEvent_3
   \   000027   E0           MOVX    A,@DPTR
   \   000028   6406         XRL     A,#0x6
   \   00002A   7003         JNZ     ??CrossCallReturnLabel_2
    304                    {
    305                      // Start sending "the" message in a regular interval.
    306                      osal_start_timerEx( Distance_TaskID,
    307                                          Distance_SEND_MSG_EVT,
    308                                          Distance_SEND_MSG_TIMEOUT );
   \                     ??Distance_ProcessEvent_3:
   \   00002C                ; Setup parameters for call to function osal_start_timerEx
   \   00002C   12....       LCALL   ?Subroutine2 & 0xFFFF
    309                    }
    310                    break;
    311          
    312                  default:
    313                    break;
    314                }
    315          
    316                // Release the memory
    317                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??CrossCallReturnLabel_2:
   \   00002F                ; Setup parameters for call to function osal_msg_deallocate
   \   00002F   EE           MOV     A,R6
   \   000030   FA           MOV     R2,A
   \   000031   EF           MOV     A,R7
   \   000032   FB           MOV     R3,A
   \   000033   12....       LCALL   ??osal_msg_deallocate?relay
    318          
    319                // Next
    320                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( Distance_TaskID );
   \   000036                ; Setup parameters for call to function osal_msg_receive
   \                     ??Distance_ProcessEvent_1:
   \   000036   90....       MOV     DPTR,#Distance_TaskID
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   F9           MOV     R1,A
   \   00003B   12....       LCALL   ??osal_msg_receive?relay
   \   00003E   8A..         MOV     ?V0 + 0,R2
   \   000040   8B..         MOV     ?V0 + 1,R3
   \   000042   AE..         MOV     R6,?V0 + 0
   \   000044   AF..         MOV     R7,?V0 + 1
   \   000046   EE           MOV     A,R6
   \   000047   4F           ORL     A,R7
   \   000048   7003         JNZ     $+5
   \   00004A   02....       LJMP    ??Distance_ProcessEvent_4 & 0xFFFF
   \   00004D   8E82         MOV     DPL,R6
   \   00004F   8F83         MOV     DPH,R7
   \   000051   E0           MOVX    A,@DPTR
   \   000052   24E6         ADD     A,#-0x1a
   \   000054   7003         JNZ     $+5
   \   000056   02....       LJMP    ??Distance_ProcessEvent_5 & 0xFFFF
   \   000059   245A         ADD     A,#0x5a
   \   00005B   7003         JNZ     $+5
   \   00005D   02....       LJMP    ??Distance_ProcessEvent_6 & 0xFFFF
   \   000060   24EF         ADD     A,#-0x11
   \   000062   60B4         JZ      ??Distance_ProcessEvent_2
   \   000064   24FE         ADD     A,#-0x2
   \   000066   70C7         JNZ     ??CrossCallReturnLabel_2
   \   000068   EE           MOV     A,R6
   \   000069   240C         ADD     A,#0xc
   \   00006B   F582         MOV     DPL,A
   \   00006D   EF           MOV     A,R7
   \   00006E   3400         ADDC    A,#0x0
   \   000070   F583         MOV     DPH,A
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F5..         MOV     ?V0 + 0,A
   \   000075   A3           INC     DPTR
   \   000076   E0           MOVX    A,@DPTR
   \   000077   F5..         MOV     ?V0 + 1,A
   \   000079   78..         MOV     R0,#?V0 + 0
   \   00007B   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for Distance_ProcessEvent>_0`:
   \   00007E   0000         DW        0
   \   000080   0200         DW        2
   \   000082   0680         DW        32774
   \   000084   ....         DW        ??Distance_ProcessEvent_7
   \   000086   2080         DW        32800
   \   000088   ....         DW        ??Distance_ProcessEvent_8
   \   00008A   ....         DW        ??CrossCallReturnLabel_2
   \                     ??Distance_ProcessEvent_7:
   \   00008C                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   00008C   EE           MOV     A,R6
   \   00008D   FA           MOV     R2,A
   \   00008E   EF           MOV     A,R7
   \   00008F   FB           MOV     R3,A
   \   000090   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000093   8A..         MOV     ?V0 + 0,R2
   \   000095   8B..         MOV     ?V0 + 1,R3
   \   000097   EA           MOV     A,R2
   \   000098   45..         ORL     A,?V0 + 1
   \   00009A   6093         JZ      ??CrossCallReturnLabel_2
   \   00009C   8A82         MOV     DPL,R2
   \   00009E   8B83         MOV     DPH,R3
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   7032         JNZ     ??Distance_ProcessEvent_9
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   A3           INC     DPTR
   \   0000A6   E0           MOVX    A,@DPTR
   \   0000A7   602C         JZ      ??Distance_ProcessEvent_9
   \   0000A9   90....       MOV     DPTR,#Distance_DstAddr + 8
   \   0000AC   7402         MOV     A,#0x2
   \   0000AE   F0           MOVX    @DPTR,A
   \   0000AF   8A82         MOV     DPL,R2
   \   0000B1   8B83         MOV     DPH,R3
   \   0000B3   A3           INC     DPTR
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F8           MOV     R0,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   F9           MOV     R1,A
   \   0000B9   90....       MOV     DPTR,#Distance_DstAddr
   \   0000BC   E8           MOV     A,R0
   \   0000BD   F0           MOVX    @DPTR,A
   \   0000BE   A3           INC     DPTR
   \   0000BF   E9           MOV     A,R1
   \   0000C0   F0           MOVX    @DPTR,A
   \   0000C1   8A82         MOV     DPL,R2
   \   0000C3   8B83         MOV     DPH,R3
   \   0000C5   A3           INC     DPTR
   \   0000C6   A3           INC     DPTR
   \   0000C7   A3           INC     DPTR
   \   0000C8   A3           INC     DPTR
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   90....       MOV     DPTR,#Distance_DstAddr + 9
   \   0000CD   F0           MOVX    @DPTR,A
   \   0000CE                ; Setup parameters for call to function HalLedSet
   \   0000CE   7A01         MOV     R2,#0x1
   \   0000D0   7908         MOV     R1,#0x8
   \   0000D2   12....       LCALL   ??HalLedSet?relay
   \                     ??Distance_ProcessEvent_9:
   \   0000D5                ; Setup parameters for call to function osal_mem_free
   \   0000D5   AA..         MOV     R2,?V0 + 0
   \   0000D7   AB..         MOV     R3,?V0 + 1
   \   0000D9   12....       LCALL   ??osal_mem_free?relay
   \   0000DC   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \                     ??Distance_ProcessEvent_8:
   \   0000DF   EE           MOV     A,R6
   \   0000E0   2413         ADD     A,#0x13
   \   0000E2   F582         MOV     DPL,A
   \   0000E4   EF           MOV     A,R7
   \   0000E5   3400         ADDC    A,#0x0
   \   0000E7   F583         MOV     DPH,A
   \   0000E9   E0           MOVX    A,@DPTR
   \   0000EA   F8           MOV     R0,A
   \   0000EB   A3           INC     DPTR
   \   0000EC   E0           MOVX    A,@DPTR
   \   0000ED   F583         MOV     DPH,A
   \   0000EF   8882         MOV     DPL,R0
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   700A         JNZ     ??Distance_ProcessEvent_10
   \   0000F4                ; Setup parameters for call to function HalLedSet
   \   0000F4   7A01         MOV     R2,#0x1
   \                     ??Distance_ProcessEvent_11:
   \   0000F6   7908         MOV     R1,#0x8
   \   0000F8   12....       LCALL   ??HalLedSet?relay
   \   0000FB   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \                     ??Distance_ProcessEvent_10:
   \   0000FE                ; Setup parameters for call to function HalLedSet
   \   0000FE   7A04         MOV     R2,#0x4
   \   000100   80F4         SJMP    ??Distance_ProcessEvent_11
   \                     ??Distance_ProcessEvent_6:
   \   000102   A3           INC     DPTR
   \   000103   A3           INC     DPTR
   \   000104   A3           INC     DPTR
   \   000105   E0           MOVX    A,@DPTR
   \   000106   F5..         MOV     ?V0 + 2,A
   \   000108   8E82         MOV     DPL,R6
   \   00010A   8F83         MOV     DPH,R7
   \   00010C   A3           INC     DPTR
   \   00010D   A3           INC     DPTR
   \   00010E   E0           MOVX    A,@DPTR
   \   00010F   6003         JZ      $+5
   \   000111   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \   000114   E5..         MOV     A,?V0 + 2
   \   000116   A2E1         MOV     C,0xE0 /* A   */.1
   \   000118   506D         JNC     ??Distance_ProcessEvent_12
   \   00011A                ; Setup parameters for call to function HalLedSet
   \   00011A   7A00         MOV     R2,#0x0
   \   00011C   7908         MOV     R1,#0x8
   \   00011E   12....       LCALL   ??HalLedSet?relay
   \   000121   7408         MOV     A,#0x8
   \   000123   12....       LCALL   ?XSTACK_DISP0_8
   \   000126   7402         MOV     A,#0x2
   \   000128   F0           MOVX    @DPTR,A
   \   000129   85..82       MOV     DPL,?XSP + 0
   \   00012C   85..83       MOV     DPH,?XSP + 1
   \   00012F   E4           CLR     A
   \   000130   F0           MOVX    @DPTR,A
   \   000131   A3           INC     DPTR
   \   000132   F0           MOVX    @DPTR,A
   \   000133                ; Setup parameters for call to function NLME_GetShortAddr
   \   000133   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000136   8A..         MOV     ?V0 + 0,R2
   \   000138   8B..         MOV     ?V0 + 1,R3
   \   00013A   AC..         MOV     R4,?V0 + 0
   \   00013C   AD..         MOV     R5,?V0 + 1
   \   00013E   75....       MOV     ?V0 + 0,#Distance_ClusterList & 0xff
   \   000141   75....       MOV     ?V0 + 1,#(Distance_ClusterList >> 8) & 0xff
   \   000144                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000144   75..00       MOV     ?V0 + 3,#0x0
   \   000147   78..         MOV     R0,#?V0 + 3
   \   000149   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00014C   78..         MOV     R0,#?V0 + 0
   \   00014E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000151   75..01       MOV     ?V0 + 3,#0x1
   \   000154   78..         MOV     R0,#?V0 + 3
   \   000156   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000159   78..         MOV     R0,#?V0 + 0
   \   00015B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00015E   75..01       MOV     ?V0 + 0,#0x1
   \   000161   78..         MOV     R0,#?V0 + 0
   \   000163   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000166   75..04       MOV     ?V0 + 0,#0x4
   \   000169   75..0F       MOV     ?V0 + 1,#0xf
   \   00016C   78..         MOV     R0,#?V0 + 0
   \   00016E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000171   90....       MOV     DPTR,#Distance_epDesc
   \   000174   E0           MOVX    A,@DPTR
   \   000175   F9           MOV     R1,A
   \   000176   7409         MOV     A,#0x9
   \   000178   12....       LCALL   ?XSTACK_DISP0_8
   \   00017B   AA82         MOV     R2,DPL
   \   00017D   AB83         MOV     R3,DPH
   \   00017F   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000182   7409         MOV     A,#0x9
   \   000184   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??Distance_ProcessEvent_12:
   \   000187   E5..         MOV     A,?V0 + 2
   \   000189   A2E3         MOV     C,0xE0 /* A   */.3
   \   00018B   4003         JC      $+5
   \   00018D   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \   000190                ; Setup parameters for call to function HalLedSet
   \   000190   7A00         MOV     R2,#0x0
   \   000192   7908         MOV     R1,#0x8
   \   000194   12....       LCALL   ??HalLedSet?relay
   \   000197   7408         MOV     A,#0x8
   \   000199   12....       LCALL   ?XSTACK_DISP0_8
   \   00019C   740F         MOV     A,#0xf
   \   00019E   F0           MOVX    @DPTR,A
   \   00019F   85..82       MOV     DPL,?XSP + 0
   \   0001A2   85..83       MOV     DPH,?XSP + 1
   \   0001A5   74FF         MOV     A,#-0x1
   \   0001A7   F0           MOVX    @DPTR,A
   \   0001A8   A3           INC     DPTR
   \   0001A9   F0           MOVX    @DPTR,A
   \   0001AA   75....       MOV     ?V0 + 0,#Distance_ClusterList & 0xff
   \   0001AD   75....       MOV     ?V0 + 1,#(Distance_ClusterList >> 8) & 0xff
   \   0001B0                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0001B0   75..00       MOV     ?V0 + 2,#0x0
   \   0001B3   78..         MOV     R0,#?V0 + 2
   \   0001B5   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001B8   78..         MOV     R0,#?V0 + 0
   \   0001BA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001BD   75..01       MOV     ?V0 + 2,#0x1
   \   0001C0   78..         MOV     R0,#?V0 + 2
   \   0001C2   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001C5   78..         MOV     R0,#?V0 + 0
   \   0001C7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001CA   75..04       MOV     ?V0 + 0,#0x4
   \   0001CD   75..0F       MOV     ?V0 + 1,#0xf
   \   0001D0   78..         MOV     R0,#?V0 + 0
   \   0001D2   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001D5   7901         MOV     R1,#0x1
   \   0001D7   7CFF         MOV     R4,#-0x1
   \   0001D9   7DFF         MOV     R5,#-0x1
   \   0001DB   7408         MOV     A,#0x8
   \   0001DD   12....       LCALL   ?XSTACK_DISP0_8
   \   0001E0   AA82         MOV     R2,DPL
   \   0001E2   AB83         MOV     R3,DPH
   \   0001E4   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0001E7   7408         MOV     A,#0x8
   \   0001E9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001EC   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \                     ??Distance_ProcessEvent_5:
   \   0001EF   A3           INC     DPTR
   \   0001F0   A3           INC     DPTR
   \   0001F1   A3           INC     DPTR
   \   0001F2   A3           INC     DPTR
   \   0001F3   E0           MOVX    A,@DPTR
   \   0001F4   6405         XRL     A,#0x5
   \   0001F6   7002         JNZ     ??Distance_ProcessEvent_13
   \   0001F8   A3           INC     DPTR
   \   0001F9   E0           MOVX    A,@DPTR
   \                     ??Distance_ProcessEvent_13:
   \   0001FA   6003         JZ      $+5
   \   0001FC   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \   0001FF                ; Setup parameters for call to function HalLcdWriteScreen
   \   0001FF   7C..         MOV     R4,#`?<Constant "rcvd">` & 0xff
   \   000201   7D..         MOV     R5,#(`?<Constant "rcvd">` >> 8) & 0xff
   \   000203   EE           MOV     A,R6
   \   000204   2422         ADD     A,#0x22
   \   000206   F582         MOV     DPL,A
   \   000208   EF           MOV     A,R7
   \   000209   3400         ADDC    A,#0x0
   \   00020B   F583         MOV     DPH,A
   \   00020D   E0           MOVX    A,@DPTR
   \   00020E   FA           MOV     R2,A
   \   00020F   A3           INC     DPTR
   \   000210   E0           MOVX    A,@DPTR
   \   000211   FB           MOV     R3,A
   \   000212   12....       LCALL   ??HalLcdWriteScreen?relay
   \   000215   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
    321              }
    322          
    323              // return unprocessed events
    324              return (events ^ SYS_EVENT_MSG);
   \                     ??Distance_ProcessEvent_4:
   \   000218   AA..         MOV     R2,?V0 + 4
   \   00021A   E5..         MOV     A,?V0 + 5
   \   00021C   6480         XRL     A,#0x80
   \   00021E   FB           MOV     R3,A
   \   00021F   02....       LJMP    ??Distance_ProcessEvent_14 & 0xFFFF
    325            }
    326          
    327            // Send a message out - This event is generated by a timer
    328            //  (setup in Distance_Init()).
    329            if ( events & Distance_SEND_MSG_EVT )
   \                     ??Distance_ProcessEvent_0:
   \   000222   EA           MOV     A,R2
   \   000223   A2E0         MOV     C,0xE0 /* A   */.0
   \   000225   4003         JC      $+5
   \   000227   02....       LJMP    ??Distance_ProcessEvent_15 & 0xFFFF
    330            {
    331              // Send "the" message
    332              Distance_SendTheMessage();
   \   00022A   7409         MOV     A,#0x9
   \   00022C   12....       LCALL   ?XSTACK_DISP0_8
   \   00022F   AC82         MOV     R4,DPL
   \   000231   AD83         MOV     R5,DPH
   \   000233   7583..       MOV     DPH,#(`?<Constant "Distance:">` >> 8) & 0xff
   \   000236   7582..       MOV     DPL,#`?<Constant "Distance:">` & 0xff
   \   000239   740F         MOV     A,#0xf
   \   00023B   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
   \   00023E                ; Setup parameters for call to function _ltoa
   \   00023E   7412         MOV     A,#0x12
   \   000240   12....       LCALL   ?XSTACK_DISP0_8
   \   000243   8582..       MOV     ?V0 + 0,DPL
   \   000246   8583..       MOV     ?V0 + 1,DPH
   \   000249   78..         MOV     R0,#?V0 + 0
   \   00024B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00024E   790A         MOV     R1,#0xa
   \   000250   90....       MOV     DPTR,#fDistance
   \   000253   12....       LCALL   ?XLOAD_R2345
   \   000256   12....       LCALL   ?R2345_FLT_TO_UL
   \   000259   AA..         MOV     R2,?V0 + 0
   \   00025B   AB..         MOV     R3,?V0 + 1
   \   00025D   AC..         MOV     R4,?V0 + 2
   \   00025F   AD..         MOV     R5,?V0 + 3
   \   000261   12....       LCALL   ??_ltoa?relay
   \   000264   7402         MOV     A,#0x2
   \   000266   12....       LCALL   ?DEALLOC_XSTACK8
   \   000269   7800         MOV     R0,#0x0
   \                     ??Distance_ProcessEvent_16:
   \   00026B   88..         MOV     ?V0 + 0,R0
   \   00026D   7409         MOV     A,#0x9
   \   00026F   12....       LCALL   ?XSTACK_DISP0_8
   \   000272   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000275   E0           MOVX    A,@DPTR
   \   000276   700B         JNZ     ??Distance_ProcessEvent_17
   \   000278   7409         MOV     A,#0x9
   \   00027A   12....       LCALL   ?XSTACK_DISP0_8
   \   00027D   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000280   7420         MOV     A,#0x20
   \   000282   F0           MOVX    @DPTR,A
   \                     ??Distance_ProcessEvent_17:
   \   000283   08           INC     R0
   \   000284   E8           MOV     A,R0
   \   000285   C3           CLR     C
   \   000286   940E         SUBB    A,#0xe
   \   000288   40E1         JC      ??Distance_ProcessEvent_16
   \   00028A                ; Setup parameters for call to function AF_DataRequest
   \   00028A   75..1E       MOV     ?V0 + 0,#0x1e
   \   00028D   78..         MOV     R0,#?V0 + 0
   \   00028F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000292   75....       MOV     ?V0 + 0,#Distance_TransID & 0xff
   \   000295   75....       MOV     ?V0 + 1,#(Distance_TransID >> 8) & 0xff
   \   000298   78..         MOV     R0,#?V0 + 0
   \   00029A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00029D   740C         MOV     A,#0xc
   \   00029F   12....       LCALL   ?XSTACK_DISP0_8
   \   0002A2   8582..       MOV     ?V0 + 0,DPL
   \   0002A5   8583..       MOV     ?V0 + 1,DPH
   \   0002A8   78..         MOV     R0,#?V0 + 0
   \   0002AA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002AD                ; Setup parameters for call to function osal_strlen
   \   0002AD   740E         MOV     A,#0xe
   \   0002AF   12....       LCALL   ?XSTACK_DISP0_8
   \   0002B2   AA82         MOV     R2,DPL
   \   0002B4   AB83         MOV     R3,DPH
   \   0002B6   12....       LCALL   ??osal_strlen?relay
   \   0002B9   EA           MOV     A,R2
   \   0002BA   2401         ADD     A,#0x1
   \   0002BC   F5..         MOV     ?V0 + 0,A
   \   0002BE   E4           CLR     A
   \   0002BF   3400         ADDC    A,#0x0
   \   0002C1   F5..         MOV     ?V0 + 1,A
   \   0002C3   78..         MOV     R0,#?V0 + 0
   \   0002C5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002C8   75..05       MOV     ?V0 + 0,#0x5
   \   0002CB   75..00       MOV     ?V0 + 1,#0x0
   \   0002CE   78..         MOV     R0,#?V0 + 0
   \   0002D0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002D3   7920         MOV     R1,#0x20
   \   0002D5   7C..         MOV     R4,#Distance_epDesc & 0xff
   \   0002D7   7D..         MOV     R5,#(Distance_epDesc >> 8) & 0xff
   \   0002D9   7A..         MOV     R2,#Distance_DstAddr & 0xff
   \   0002DB   7B..         MOV     R3,#(Distance_DstAddr >> 8) & 0xff
   \   0002DD   12....       LCALL   ??AF_DataRequest?relay
   \   0002E0   7409         MOV     A,#0x9
   \   0002E2   12....       LCALL   ?DEALLOC_XSTACK8
    333          
    334              // Setup to send message again
    335              osal_start_timerEx( Distance_TaskID,
    336                                  Distance_SEND_MSG_EVT,
    337                                  Distance_SEND_MSG_TIMEOUT );
   \   0002E5                ; Setup parameters for call to function osal_start_timerEx
   \   0002E5   12....       LCALL   ?Subroutine2 & 0xFFFF
    338          
    339              // return unprocessed events
    340              return (events ^ Distance_SEND_MSG_EVT);
   \                     ??CrossCallReturnLabel_3:
   \   0002E8   E5..         MOV     A,?V0 + 4
   \   0002EA   6401         XRL     A,#0x1
   \   0002EC   FA           MOV     R2,A
   \   0002ED   AB..         MOV     R3,?V0 + 5
   \   0002EF   8004         SJMP    ??Distance_ProcessEvent_14
    341            }
    342          
    343            
    344          #if defined( IAR_ARMCM3_LM )
    345            // Receive a message from the RTOS queue
    346            if ( events & Distance_RTOS_MSG_EVT )
    347            {
    348              // Process message from RTOS queue
    349              Distance_ProcessRtosMessage();
    350          
    351              // return unprocessed events
    352              return (events ^ Distance_RTOS_MSG_EVT);
    353            }
    354          #endif
    355          
    356            // Discard unknown events
    357            return 0;
   \                     ??Distance_ProcessEvent_15:
   \   0002F1   7A00         MOV     R2,#0x0
   \   0002F3   7B00         MOV     R3,#0x0
   \                     ??Distance_ProcessEvent_14:
   \   0002F5   7418         MOV     A,#0x18
   \   0002F7   12....       LCALL   ?DEALLOC_XSTACK8
   \   0002FA   7F06         MOV     R7,#0x6
   \   0002FC   02....       LJMP    ?BANKED_LEAVE_XDATA
    358          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7CE8         MOV     R4,#-0x18
   \   000002   7D03         MOV     R5,#0x3
   \   000004   7A01         MOV     R2,#0x1
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#Distance_TaskID
   \   00000B                REQUIRE ??Subroutine3_0
   \   00000B                ; // Fall through to label ??Subroutine3_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine3_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F9           MOV     R1,A
   \   000002   12....       LCALL   ??osal_start_timerEx?relay
   \   000005   22           RET
    359          
    360          /*********************************************************************
    361           * Event Generation Functions
    362           */
    363          
    364          /*********************************************************************
    365           * @fn      Distance_ProcessZDOMsgs()
    366           *
    367           * @brief   Process response messages
    368           *
    369           * @param   none
    370           *
    371           * @return  none
    372           */
    373          static void Distance_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    374          {
    375            switch ( inMsg->clusterID )
    376            {
    377              case End_Device_Bind_rsp:
    378                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    379                {
    380                  // Distance LED
    381                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    382                }
    383          #if defined( BLINK_LEDS )
    384                else
    385                {
    386                  // Flash LED to show failure
    387                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
    388                }
    389          #endif
    390                break;
    391          
    392              case Match_Desc_rsp:
    393                {
    394                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    395                  if ( pRsp )
    396                  {
    397                    if ( pRsp->status == ZSuccess && pRsp->cnt )
    398                    {
    399                      Distance_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
    400                      Distance_DstAddr.addr.shortAddr = pRsp->nwkAddr;
    401                      // Take the first endpoint, Can be changed to search through endpoints
    402                      Distance_DstAddr.endPoint = pRsp->epList[0];
    403          
    404                      // Distance LED
    405                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    406                    }
    407                    osal_mem_free( pRsp );
    408                  }
    409                }
    410                break;
    411            }
    412          }
    413          
    414          /*********************************************************************
    415           * @fn      Distance_HandleKeys
    416           *
    417           * @brief   Handles all key events for this device.
    418           *
    419           * @param   shift - true if in shift/alt.
    420           * @param   keys - bit field for key events. Valid entries:
    421           *                 HAL_KEY_SW_4
    422           *                 HAL_KEY_SW_3
    423           *                 HAL_KEY_SW_2
    424           *                 HAL_KEY_SW_1
    425           *
    426           * @return  none
    427           */
    428          static void Distance_HandleKeys( uint8 shift, uint8 keys )
    429          {
    430            zAddrType_t dstAddr;
    431          
    432            // Shift is used to make each button/switch dual purpose.
    433            if ( shift )
    434            {
    435              if ( keys & HAL_KEY_SW_1 )
    436              {
    437              }
    438              if ( keys & HAL_KEY_SW_2 )
    439              {
    440              }
    441              if ( keys & HAL_KEY_SW_3 )
    442              {
    443              }
    444              if ( keys & HAL_KEY_SW_4 )
    445              {
    446              }
    447            }
    448            else
    449            {
    450              if ( keys & HAL_KEY_SW_1 )
    451              {
    452                // Since SW1 isn't used for anything else in this application...
    453          #if defined( SWITCH1_BIND )
    454                // we can use SW1 to simulate SW2 for devices that only have one switch,
    455                keys |= HAL_KEY_SW_2;
    456          #elif defined( SWITCH1_MATCH )
    457                // or use SW1 to simulate SW4 for devices that only have one switch
    458                keys |= HAL_KEY_SW_4;
    459          #endif
    460              }
    461          
    462              if ( keys & HAL_KEY_SW_2 )
    463              {
    464                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    465          
    466                // Initiate an End Device Bind Request for the mandatory endpoint
    467                dstAddr.addrMode = Addr16Bit;
    468                dstAddr.addr.shortAddr = 0x0000; // Coordinator
    469                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    470                                      Distance_epDesc.endPoint,
    471                                      Distance_PROFID,
    472                                      Distance_MAX_CLUSTERS, (cId_t *)Distance_ClusterList,
    473                                      Distance_MAX_CLUSTERS, (cId_t *)Distance_ClusterList,
    474                                      FALSE );
    475              }
    476          
    477              if ( keys & HAL_KEY_SW_3 )
    478              {
    479              }
    480          
    481              if ( keys & HAL_KEY_SW_4 )
    482              {
    483                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    484                // Initiate a Match Description Request (Service Discovery)
    485                dstAddr.addrMode = AddrBroadcast;
    486                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    487                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    488                                  Distance_PROFID,
    489                                  Distance_MAX_CLUSTERS, (cId_t *)Distance_ClusterList,
    490                                  Distance_MAX_CLUSTERS, (cId_t *)Distance_ClusterList,
    491                                  FALSE );
    492              }
    493            }
    494          }
    495          
    496          /*********************************************************************
    497           * LOCAL FUNCTIONS
    498           */
    499          
    500          /*********************************************************************
    501           * @fn      Distance_MessageMSGCB
    502           *
    503           * @brief   Data message processor callback.  This function processes
    504           *          any incoming data - probably from other devices.  So, based
    505           *          on cluster ID, perform the intended action.
    506           *
    507           * @param   none
    508           *
    509           * @return  none
    510           */
    511          static void Distance_MessageMSGCB( afIncomingMSGPacket_t *pkt )
    512          {
    513            switch ( pkt->clusterId )
    514            {
    515              case Distance_CLUSTERID:
    516                // "the" message
    517          #if defined( LCD_SUPPORTED )
    518                HalLcdWriteScreen( (char*)pkt->cmd.Data, "rcvd" );
    519          #elif defined( WIN32 )
    520                WPRINTSTR( pkt->cmd.Data );
    521          #endif
    522                break;
    523            }
    524          }
    525          
    526          /*********************************************************************
    527           * @fn      Distance_SendTheMessage
    528           *
    529           * @brief   Send "the" message.
    530           *
    531           * @param   none
    532           *
    533           * @return  none
    534           */
    535          static void Distance_SendTheMessage( void )
    536          {
    537            unsigned char theMessageData[15] = "Distance:";
    538            
    539            _ltoa( (uint32)(fDistance), &theMessageData[9], 10 );
    540            
    541            for (unsigned char i=0; i<15-1; i++)
    542            {
    543              if (theMessageData[i] == 0x00 )
    544              {
    545                theMessageData[i] = ' ';
    546              }
    547            }
    548          
    549            if ( AF_DataRequest( &Distance_DstAddr, &Distance_epDesc,
    550                                 Distance_CLUSTERID,
    551                                 (byte)osal_strlen( theMessageData ) + 1,
                                                           ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char *"
    552                                 (byte *)&theMessageData,
    553                                 &Distance_TransID,
    554                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    555            {
    556              // Successfully requested to be sent.
    557            }
    558            else
    559            {
    560              // Error occurred in request to send.
    561            }
    562          }
    563          
    564          #if defined( IAR_ARMCM3_LM )
    565          /*********************************************************************
    566           * @fn      Distance_ProcessRtosMessage
    567           *
    568           * @brief   Receive message from RTOS queue, send response back.
    569           *
    570           * @param   none
    571           *
    572           * @return  none
    573           */
    574          static void Distance_ProcessRtosMessage( void )
    575          {
    576            osalQueue_t inMsg;
    577          
    578            if ( osal_queue_receive( OsalQueue, &inMsg, 0 ) == pdPASS )
    579            {
    580              uint8 cmndId = inMsg.cmnd;
    581              uint32 counter = osal_build_uint32( inMsg.cbuf, 4 );
    582          
    583              switch ( cmndId )
    584              {
    585                case CMD_INCR:
    586                  counter += 1;  /* Increment the incoming counter */
    587                                 /* Intentionally fall through next case */
    588          
    589                case CMD_ECHO:
    590                {
    591                  userQueue_t outMsg;
    592          
    593                  outMsg.resp = RSP_CODE | cmndId;  /* Response ID */
    594                  osal_buffer_uint32( outMsg.rbuf, counter );    /* Increment counter */
    595                  osal_queue_send( UserQueue1, &outMsg, 0 );  /* Send back to UserTask */
    596                  break;
    597                }
    598                
    599                default:
    600                  break;  /* Ignore unknown command */    
    601              }
    602            }
    603          }
    604          
    605          #endif
    606          
    607          //***********************************************************************************
    608          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    609          uint16 DistanceMeasurement_ProcessEvent( uint8 task_id, uint16 events )
   \                     DistanceMeasurement_ProcessEvent:
    610          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    611            if ( events & DISTANCEMEASUREMENT_EVT )
   \   000009   EE           MOV     A,R6
   \   00000A   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000C   502D         JNC     ??DistanceMeasurement_ProcessEvent_0
    612            {
    613            osal_start_timerEx( DistanceMeasurement_TaskID,
    614                                  DISTANCEMEASUREMENT_EVT,
    615                                  DISTANCEMEASUREMENT_TIMEOUT );
   \   00000E                ; Setup parameters for call to function osal_start_timerEx
   \   00000E   7CF4         MOV     R4,#-0xc
   \   000010   7D01         MOV     R5,#0x1
   \   000012   7A01         MOV     R2,#0x1
   \   000014   7B00         MOV     R3,#0x0
   \   000016   90....       MOV     DPTR,#DistanceMeasurement_TaskID
   \   000019   12....       LCALL   ??Subroutine3_0 & 0xFFFF
    616          
    617              SysClkSet32M();
   \                     ??CrossCallReturnLabel_4:
   \   00001C                ; Setup parameters for call to function SysClkSet32M
   \   00001C   12....       LCALL   ??SysClkSet32M?relay
    618              Init_GPIO();
   \   00001F                ; Setup parameters for call to function Init_GPIO
   \   00001F   12....       LCALL   ??Init_GPIO?relay
    619              Init_Key1();
   \   000022                ; Setup parameters for call to function Init_Key1
   \   000022   12....       LCALL   ??Init_Key1?relay
    620              TRIG =0;      //TRIG´¥·¢²â¾à
   \   000025   C297         CLR     0x90.7
    621              Delay_10us(); //¸øÖÁÉÙ10usµÄ¸ßµçÆ½ÐÅºÅ
   \   000027                ; Setup parameters for call to function Delay_10us
   \   000027   12....       LCALL   ??Delay_10us?relay
    622              TRIG =1;      //TRIG´¥·¢ÖÕÖ¹
   \   00002A   D297         SETB    0x90.7
    623              Delayms(50);//ÑÓÊ±ÖÜÆÚ
   \   00002C                ; Setup parameters for call to function Delayms
   \   00002C   7A32         MOV     R2,#0x32
   \   00002E   7B00         MOV     R3,#0x0
   \   000030   12....       LCALL   ??Delayms?relay
    624              
    625              //HalLedSet ( HAL_LED_2, HAL_LED_MODE_TOGGLE );
    626          
    627              // return unprocessed events
    628              return (events ^ DISTANCEMEASUREMENT_EVT);
   \   000033   EE           MOV     A,R6
   \   000034   6401         XRL     A,#0x1
   \   000036   FA           MOV     R2,A
   \   000037   EF           MOV     A,R7
   \   000038   FB           MOV     R3,A
   \   000039   8004         SJMP    ??DistanceMeasurement_ProcessEvent_1
    629            }
    630          
    631            // Discard unknown events
    632            return 0;
   \                     ??DistanceMeasurement_ProcessEvent_0:
   \   00003B   7A00         MOV     R2,#0x0
   \   00003D   7B00         MOV     R3,#0x0
   \                     ??DistanceMeasurement_ProcessEvent_1:
   \   00003F   02....       LJMP    ?Subroutine0 & 0xFFFF
   \   000042                REQUIRE _A_P1
    633          }
    634          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    635          void DistanceMeasurement_Init( uint8 task_id )
   \                     DistanceMeasurement_Init:
    636          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    637            DistanceMeasurement_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#DistanceMeasurement_TaskID
   \   000009   F0           MOVX    @DPTR,A
    638            DistanceMeasurement_TransID = 0;
   \   00000A   90....       MOV     DPTR,#DistanceMeasurement_TransID
   \   00000D   E4           CLR     A
   \   00000E   F0           MOVX    @DPTR,A
    639            
    640            osal_start_timerEx( DistanceMeasurement_TaskID,
    641                                  DISTANCEMEASUREMENT_EVT,
    642                                  DISTANCEMEASUREMENT_TIMEOUT );
   \   00000F                ; Setup parameters for call to function osal_start_timerEx
   \   00000F   7CF4         MOV     R4,#-0xc
   \   000011   7D01         MOV     R5,#0x1
   \   000013   7A01         MOV     R2,#0x1
   \   000015   FB           MOV     R3,A
   \   000016   12....       LCALL   ??osal_start_timerEx?relay
    643            
    644            RegisterForKeys( DistanceMeasurement_TaskID );  
   \   000019                ; Setup parameters for call to function RegisterForKeys
   \   000019   90....       MOV     DPTR,#DistanceMeasurement_TaskID
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   12....       LCALL   ??RegisterForKeys?relay
    645          }
   \   000021   02....       LJMP    ?Subroutine0 & 0xFFFF
    646          
    647          
    648          /*********************************************************************
    649           */

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    650          HAL_ISR_FUNCTION( halKeyPort1Isr, P1INT_VECTOR )
   \                     halKeyPort1Isr:
    651          {
   \   000000   C0E0         PUSH    A
   \   000002   74EB         MOV     A,#-0x15
   \   000004   12....       LCALL   ?INTERRUPT_ENTER_XSP
   \   000007                ; Saved register size: 21
   \   000007                ; Auto size: 0
    652            
    653            if (HAL_KEY_SW_7_PXIFG & HAL_KEY_SW_7_BIT)
   \   000007   E58A         MOV     A,0x8a
   \   000009   A2E3         MOV     C,0xE0 /* A   */.3
   \   00000B   4003         JC      $+5
   \   00000D   02....       LJMP    ??halKeyPort1Isr_0
    654            {
    655              Init_T1();
   \   000010                ; Setup parameters for call to function Init_T1
   \   000010   12....       LCALL   ??Init_T1?relay
    656              while(ECHO);
   \                     ??halKeyPort1Isr_1:
   \   000013   A293         MOV     C,0x90.3
   \   000015   40FC         JC      ??halKeyPort1Isr_1
    657              L=T1CNTL; 
   \   000017   E5E2         MOV     A,0xe2
   \   000019   90....       MOV     DPTR,#L
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   E4           CLR     A
   \   00001F   F0           MOVX    @DPTR,A
    658              H=T1CNTH;
   \   000020   E5E3         MOV     A,0xe3
   \   000022   90....       MOV     DPTR,#H
   \   000025   F0           MOVX    @DPTR,A
   \   000026   A3           INC     DPTR
   \   000027   E4           CLR     A
   \   000028   F0           MOVX    @DPTR,A
    659              s=256*H;
   \   000029   90....       MOV     DPTR,#H
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F5..         MOV     ?V0 + 0,A
   \   00002F   E4           CLR     A
   \   000030   C5..         XCH     A,?V0 + 0
   \   000032   F5..         MOV     ?V0 + 1,A
   \   000034   E4           CLR     A
   \   000035   F5..         MOV     ?V0 + 2,A
   \   000037   F5..         MOV     ?V0 + 3,A
   \   000039   78..         MOV     R0,#?V0 + 0
   \   00003B   12....       LCALL   ?UL_TO_FLT
   \   00003E   90....       MOV     DPTR,#`s`
   \   000041   78..         MOV     R0,#?V0 + 0
   \   000043   12....       LCALL   ?L_MOV_TO_X
    660              distance=((s+L)*340)/30000.0;
   \   000046   90....       MOV     DPTR,#L
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F5..         MOV     ?V0 + 0,A
   \   00004C   E4           CLR     A
   \   00004D   F5..         MOV     ?V0 + 1,A
   \   00004F   F5..         MOV     ?V0 + 2,A
   \   000051   F5..         MOV     ?V0 + 3,A
   \   000053   78..         MOV     R0,#?V0 + 0
   \   000055   12....       LCALL   ?UL_TO_FLT
   \   000058   90....       MOV     DPTR,#`s`
   \   00005B   78..         MOV     R0,#?V0 + 4
   \   00005D   12....       LCALL   ?L_MOV_X
   \   000060   78..         MOV     R0,#?V0 + 0
   \   000062   79..         MOV     R1,#?V0 + 4
   \   000064   12....       LCALL   ?FLT_ADD
   \   000067   90....       MOV     DPTR,#__Constant_43aa0000
   \   00006A   78..         MOV     R0,#?V0 + 4
   \   00006C   12....       LCALL   ?L_MOV_X
   \   00006F   78..         MOV     R0,#?V0 + 0
   \   000071   79..         MOV     R1,#?V0 + 4
   \   000073   12....       LCALL   ?FLT_MUL
   \   000076   90....       MOV     DPTR,#__Constant_46ea6000
   \   000079   78..         MOV     R0,#?V0 + 4
   \   00007B   12....       LCALL   ?L_MOV_X
   \   00007E   78..         MOV     R0,#?V0 + 0
   \   000080   79..         MOV     R1,#?V0 + 4
   \   000082   12....       LCALL   ?FLT_DIV
   \   000085   90....       MOV     DPTR,#distance
   \   000088   78..         MOV     R0,#?V0 + 0
   \   00008A   12....       LCALL   ?L_MOV_TO_X
    661              fDistance=distance/2;
   \   00008D   90....       MOV     DPTR,#distance
   \   000090   78..         MOV     R0,#?V0 + 0
   \   000092   12....       LCALL   ?L_MOV_X
   \   000095   90....       MOV     DPTR,#__Constant_3f000000
   \   000098   78..         MOV     R0,#?V0 + 4
   \   00009A   12....       LCALL   ?L_MOV_X
   \   00009D   78..         MOV     R0,#?V0 + 0
   \   00009F   79..         MOV     R1,#?V0 + 4
   \   0000A1   12....       LCALL   ?FLT_MUL
   \   0000A4   90....       MOV     DPTR,#fDistance
   \   0000A7   78..         MOV     R0,#?V0 + 0
   \   0000A9   12....       LCALL   ?L_MOV_TO_X
    662              T1CNTL=0x0000;
   \   0000AC   75E200       MOV     0xe2,#0x0
    663              T1CNTH=0x0000;
   \   0000AF   75E300       MOV     0xe3,#0x0
    664              P1IFG = 0;             //ÇåÖÐ¶Ï±êÖ¾ 
   \   0000B2   758A00       MOV     0x8a,#0x0
    665              P1IF = 0;             //ÇåÖÐ¶Ï±êÖ¾ 
   \   0000B5   C2EB         CLR     0xe8.3
    666            }
    667          }
   \                     ??halKeyPort1Isr_0:
   \   0000B7   7F08         MOV     R7,#0x8
   \   0000B9   02....       LJMP    ?INTERRUPT_LEAVE_XSP
   \   0000BC                REQUIRE P1IFG
   \   0000BC                REQUIRE _A_P1
   \   0000BC                REQUIRE T1CNTL
   \   0000BC                REQUIRE T1CNTH
   \   0000BC                REQUIRE _A_IRCON2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   E582         MOV     A,DPL
   \   000002   25..         ADD     A,?V0 + 0
   \   000004   F582         MOV     DPL,A
   \   000006   E583         MOV     A,DPH
   \   000008   3400         ADDC    A,#0x0
   \   00000A   F583         MOV     DPH,A
   \   00000C   22           RET

   \                                 In  segment INTVEC, offset 0x7b, root
   \                     `??halKeyPort1Isr??INTVEC 123`:
   \   00007B   02....       LJMP       (halKeyPort1Isr)

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Distance_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Distance_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Distance_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Distance_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??DistanceMeasurement_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    DistanceMeasurement_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??DistanceMeasurement_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    DistanceMeasurement_Init

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Distance">`:
   \   000000   44697374     DB "Distance"
   \            616E6365
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "rcvd">`:
   \   000000   72637664     DB "rcvd"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Distance:">`:
   \   000000   44697374     DB "Distance:"
   \            616E6365
   \            3A00    
   \   00000A   00000000     DB 0, 0, 0, 0, 0
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_43aa0000:
   \   000000   0000AA43     DD 43AA0000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_46ea6000:
   \   000000   0060EA46     DD 46EA6000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3f000000:
   \   000000   0000003F     DD 3F000000H

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     DistanceMeasurement_Init           0      0      9
       -> osal_start_timerEx            0      0     18
       -> RegisterForKeys               0      0     18
     DistanceMeasurement_ProcessEvent
                                        0      0      9
       -> osal_start_timerEx            0      0     18
       -> SysClkSet32M                  0      0     18
       -> Init_GPIO                     0      0     18
       -> Init_Key1                     0      0     18
       -> Delay_10us                    0      0     18
       -> Delayms                       0      0     18
     Distance_Init                      0      0      9
       -> afRegister                    0      0     18
       -> RegisterForKeys               0      0     18
       -> HalLcdWriteString             0      0     18
       -> ZDO_RegisterForZDOMsg         0      0     18
       -> ZDO_RegisterForZDOMsg         0      0     18
     Distance_ProcessEvent              2      0     47
       -> osal_msg_receive              0      0     76
       -> osal_start_timerEx            0      0     76
       -> osal_msg_deallocate           0      0     76
       -> osal_msg_receive              0      0     76
       -> ZDO_ParseEPListRsp            0      0     76
       -> HalLedSet                     0      0     76
       -> osal_mem_free                 0      0     76
       -> HalLedSet                     0      0     76
       -> HalLedSet                     0      0     76
       -> HalLedSet                     0      0     76
       -> NLME_GetShortAddr             0      0     76
       -> ZDP_EndDeviceBindReq          0      0     94
       -> HalLedSet                     0      0     76
       -> ZDP_MatchDescReq              0      0     92
       -> HalLcdWriteScreen             0      0     76
       -> _ltoa                         0      0     80
       -> osal_strlen                   0      0     86
       -> AF_DataRequest                0      0     94
       -> osal_start_timerEx            0      0     76
     halKeyPort1Isr                     0      0     21
       -> Init_T1                       0      0     42


   Segment part sizes:

     Function/Label                           Bytes
     --------------                           -----
     P1IFG                                       1
     _A_P1                                       1
     T1CNTL                                      1
     T1CNTH                                      1
     _A_IRCON2                                   1
     Distance_ClusterList                        2
     Distance_SimpleDesc                        12
     Distance_epDesc                             6
     Distance_TaskID                             1
     Distance_NwkState                           1
     Distance_TransID                            1
     Distance_DstAddr                           12
     DistanceMeasurement_TaskID                  1
     DistanceMeasurement_NwkState                1
     DistanceMeasurement_TransID                 1
     fDistance                                   4
     distance                                    4
     s                                           4
     dis                                         2
     H                                           2
     H1                                          2
     L                                           2
     L1                                          2
     Distance_Init                             106
     ?Subroutine0                                5
     Distance_ProcessEvent                     767
     ?Subroutine2                               11
     ??Subroutine3_0                             6
     DistanceMeasurement_ProcessEvent
                                                66
     DistanceMeasurement_Init                   36
     halKeyPort1Isr                            188
     ?Subroutine1                               13
     ??halKeyPort1Isr??INTVEC 123                3
     ??Distance_Init?relay                       6
     ??Distance_ProcessEvent?relay               6
     ??DistanceMeasurement_ProcessEvent?relay    6
     ??DistanceMeasurement_Init?relay            6
     ?<Constant "Distance">                      9
     ?<Constant "rcvd">                          5
     ?<Constant "Distance:">                    15
     __Constant_43aa0000                         4
     __Constant_46ea6000                         4
     __Constant_3f000000                         4

 
 1 010 bytes in segment BANKED_CODE
    24 bytes in segment BANK_RELAYS
     3 bytes in segment INTVEC
   188 bytes in segment NEAR_CODE
     5 bytes in segment SFR_AN
    55 bytes in segment XDATA_ROM_C
    46 bytes in segment XDATA_Z
 
 1 222 bytes of CODE  memory (+  3 bytes shared)
    43 bytes of CONST memory (+ 12 bytes shared)
     0 bytes of DATA  memory (+  5 bytes shared)
    46 bytes of XDATA memory

Errors: none
Warnings: 1
