###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         31/Jan/2014  22:08:55 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\02Light_ENDDB\Source\Light.c       #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\02Light_ENDDB\CC2530DB\..\..\. #
#                          .\Tools\CC2530DB\f8wEndev.cfg" (-DCPU32MHZ         #
#                          -DROOT=__near_func -DMAC_CFG_TX_DATA_MAX=3         #
#                          -DMAC_CFG_TX_MAX=6 -DMAC_CFG_RX_MAX=3) -f          #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\02Light_ENDDB\CC2530DB\..\..\..\T #
#                          ools\CC2530DB\f8wConfig.cfg" (-DZIGBEEPRO          #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\Source\Light.c" -D            #
#                          NWK_AUTO_POLL -D ZTOOL_P1 -D MT_TASK -D            #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -D xPOWER_SAVING -lC "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\EndDeviceEB\List\"   #
#                          -lA "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Pro #
#                          jects\zstack\Samples\02Light_ENDDB\CC2530DB\EndDev #
#                          iceEB\List\" --diag_suppress Pe001,Pa010 -o        #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\02Light_ENDDB\CC2530DB\EndDeviceE #
#                          B\Obj\" -e --no_code_motion --debug --core=plain   #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\" -I "C:\Texas       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\Source\" -I       #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\02Light_ENDDB\CC2530DB\..\..\..\Z #
#                          Main\TI2530DB\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\hal\include\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\hal\target\CC2530EB\" -I "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\include\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\high_level\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\low_level\srf04\" -I "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\low_level\srf04\single_chip\" -I         #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\02Light_ENDDB\CC2530DB\..\..\..\. #
#                          .\..\Components\mt\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\osal\include\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\services\saddr\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\services\sdata\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\af\" -I "C:\Texas                      #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\nwk\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sapi\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sec\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\sys\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\stack\zdo\" -I "C:\Texas                     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\zmac\" -I "C:\Texas                          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\02Light_ENDDB\CC2530DB\..\..\..\..\..\Compo #
#                          nents\zmac\f8w\" -Ohz --require_prototypes         #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\02Light_ENDDB\CC2530DB\EndDeviceEB #
#                          \List\Light.lst                                    #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\02Light_ENDDB\CC2530DB\EndDeviceEB #
#                          \Obj\Light.r51                                     #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\02Light_ENDDB\Source\Light.c
      1          /******************************************************************************
      2            Filename:       Light.c
      3            Revised:        $Date: 2012-03-07 01:04:58 -0800 (Wed, 07 Mar 2012) $
      4            Revision:       $Revision: 29656 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License"). You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product. Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          ******************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends "Hello World" to another "Generic"
     45            application every 5 seconds.  The application will also
     46            receives "Hello World" packets.
     47          
     48            The "Hello World" messages are sent/received as MSG type message.
     49          
     50            This applications doesn't have a profile, so it handles everything
     51            directly - itself.
     52          
     53            Key control:
     54              SW1:
     55              SW2:  initiates end device binding
     56              SW3:
     57              SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include "OSAL.h"
     64          #include "AF.h"
     65          #include "ZDApp.h"
     66          #include "ZDObject.h"
     67          #include "ZDProfile.h"
     68          
     69          #include "Light.h"
     70          #include "DebugTrace.h"
     71          
     72          #include "BH1750.h"
     73          
     74          #if !defined( WIN32 )
     75            #include "OnBoard.h"
     76          #endif
     77          
     78          /* HAL */
     79          #include "hal_lcd.h"
     80          #include "hal_led.h"
     81          #include "hal_key.h"
     82          #include "hal_uart.h"
     83          
     84          /* RTOS */
     85          #if defined( IAR_ARMCM3_LM )
     86          #include "RTOS_App.h"
     87          #endif  
     88          
     89          /*********************************************************************
     90           * MACROS
     91           */
     92          
     93          /*********************************************************************
     94           * CONSTANTS
     95           */
     96          
     97          /*********************************************************************
     98           * TYPEDEFS
     99           */
    100          
    101          /*********************************************************************
    102           * GLOBAL VARIABLES
    103           */
    104          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    105          const cId_t Light_ClusterList[LIGHT_MAX_CLUSTERS] =
   \                     Light_ClusterList:
   \   000000   0100         DW 1
    106          {
    107            LIGHT_CLUSTERID
    108          };
    109          

   \                                 In  segment XDATA_ROM_C, align 1
    110          const SimpleDescriptionFormat_t Light_SimpleDesc =
   \                     Light_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   01           DB 1
   \   000007   ....         DW Light_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW Light_ClusterList
    111          {
    112            LIGHT_ENDPOINT,              //  int Endpoint;
    113            LIGHT_PROFID,                //  uint16 AppProfId[2];
    114            LIGHT_DEVICEID,              //  uint16 AppDeviceId[2];
    115            LIGHT_DEVICE_VERSION,        //  int   AppDevVer:4;
    116            LIGHT_FLAGS,                 //  int   AppFlags:4;
    117            LIGHT_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    118            (cId_t *)Light_ClusterList,  //  byte *pAppInClusterList;
    119            LIGHT_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    120            (cId_t *)Light_ClusterList   //  byte *pAppInClusterList;
    121          };
    122          
    123          // This is the Endpoint/Interface description.  It is defined here, but
    124          // filled-in in Light_Init().  Another way to go would be to fill
    125          // in the structure here and make it a "const" (in code space).  The
    126          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    127          endPointDesc_t Light_epDesc;
   \                     Light_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    128          
    129          /*********************************************************************
    130           * EXTERNAL VARIABLES
    131           */
    132          
    133          /*********************************************************************
    134           * EXTERNAL FUNCTIONS
    135           */
    136          
    137          /*********************************************************************
    138           * LOCAL VARIABLES
    139           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    140          byte Light_TaskID;   // Task ID for internal task/event processing
   \                     Light_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    141                                    // This variable will be received when
    142                                    // Light_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          devStates_t Light_NwkState;
   \                     Light_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    144          
    145          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          byte Light_TransID;  // This is the unique message ID (counter)
   \                     Light_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    147          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    148          afAddrType_t Light_DstAddr;
   \                     Light_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    149          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          byte LightMeasurement_TaskID;
   \                     LightMeasurement_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    151          devStates_t LightMeasurement_NwkState;
   \                     LightMeasurement_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          byte LightMeasurement_TransID;
   \                     LightMeasurement_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          float fLight;
   \                     fLight:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    155          
    156          /*********************************************************************
    157           * LOCAL FUNCTIONS
    158           */
    159          static void Light_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    160          static void Light_HandleKeys( byte shift, byte keys );
    161          static void Light_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    162          static void Light_SendTheMessage( void );
    163          
    164          #if defined( IAR_ARMCM3_LM )
    165          static void Light_ProcessRtosMessage( void );
    166          #endif
    167          
    168          /*********************************************************************
    169           * NETWORK LAYER CALLBACKS
    170           */
    171          
    172          /*********************************************************************
    173           * PUBLIC FUNCTIONS
    174           */
    175          
    176          /*********************************************************************
    177           * @fn      Light_Init
    178           *
    179           * @brief   Initialization function for the Generic App Task.
    180           *          This is called during initialization and should contain
    181           *          any application specific initialization (ie. hardware
    182           *          initialization/setup, table initialization, power up
    183           *          notificaiton ... ).
    184           *
    185           * @param   task_id - the ID assigned by OSAL.  This ID should be
    186           *                    used to send messages and set timers.
    187           *
    188           * @return  none
    189           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    190          void Light_Init( uint8 task_id )
   \                     Light_Init:
    191          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    192            Light_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#Light_TaskID
   \   000009   F0           MOVX    @DPTR,A
    193            Light_NwkState = DEV_INIT;
   \   00000A   90....       MOV     DPTR,#Light_NwkState
   \   00000D   7401         MOV     A,#0x1
   \   00000F   F0           MOVX    @DPTR,A
    194            Light_TransID = 0;
   \   000010   90....       MOV     DPTR,#Light_TransID
   \   000013   E4           CLR     A
   \   000014   F0           MOVX    @DPTR,A
    195          
    196            // Device hardware initialization can be added here or in main() (Zmain.c).
    197            // If the hardware is application specific - add it here.
    198            // If the hardware is other parts of the device add it in main().
    199          
    200            Light_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   000015   90....       MOV     DPTR,#Light_DstAddr + 8
   \   000018   F0           MOVX    @DPTR,A
    201            Light_DstAddr.endPoint = 0;
   \   000019   A3           INC     DPTR
   \   00001A   F0           MOVX    @DPTR,A
    202            Light_DstAddr.addr.shortAddr = 0;
   \   00001B   90....       MOV     DPTR,#Light_DstAddr
   \   00001E   F0           MOVX    @DPTR,A
   \   00001F   A3           INC     DPTR
   \   000020   F0           MOVX    @DPTR,A
    203          
    204            // Fill out the endpoint description.
    205            Light_epDesc.endPoint = LIGHT_ENDPOINT;
   \   000021   90....       MOV     DPTR,#Light_epDesc
   \   000024   740A         MOV     A,#0xa
   \   000026   F0           MOVX    @DPTR,A
    206            Light_epDesc.task_id = &Light_TaskID;
   \   000027   A3           INC     DPTR
   \   000028   74..         MOV     A,#Light_TaskID & 0xff
   \   00002A   F0           MOVX    @DPTR,A
   \   00002B   A3           INC     DPTR
   \   00002C   74..         MOV     A,#(Light_TaskID >> 8) & 0xff
   \   00002E   F0           MOVX    @DPTR,A
    207            Light_epDesc.simpleDesc
    208                      = (SimpleDescriptionFormat_t *)&Light_SimpleDesc;
   \   00002F   A3           INC     DPTR
   \   000030   74..         MOV     A,#Light_SimpleDesc & 0xff
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   74..         MOV     A,#(Light_SimpleDesc >> 8) & 0xff
   \   000036   F0           MOVX    @DPTR,A
    209            Light_epDesc.latencyReq = noLatencyReqs;
   \   000037   A3           INC     DPTR
   \   000038   E4           CLR     A
   \   000039   F0           MOVX    @DPTR,A
    210          
    211            // Register the endpoint description with the AF
    212            afRegister( &Light_epDesc );
   \   00003A                ; Setup parameters for call to function afRegister
   \   00003A   7A..         MOV     R2,#Light_epDesc & 0xff
   \   00003C   7B..         MOV     R3,#(Light_epDesc >> 8) & 0xff
   \   00003E   12....       LCALL   ??afRegister?relay
    213          
    214            // Register for all key events - This app will handle all key events
    215            RegisterForKeys( Light_TaskID );
   \   000041                ; Setup parameters for call to function RegisterForKeys
   \   000041   90....       MOV     DPTR,#Light_TaskID
   \   000044   E0           MOVX    A,@DPTR
   \   000045   F9           MOV     R1,A
   \   000046   12....       LCALL   ??RegisterForKeys?relay
    216          
    217            // Update the display
    218          #if defined ( LCD_SUPPORTED )
    219            HalLcdWriteString( "Light", HAL_LCD_LINE_1 );
   \   000049                ; Setup parameters for call to function HalLcdWriteString
   \   000049   7901         MOV     R1,#0x1
   \   00004B   7A..         MOV     R2,#`?<Constant "Light">` & 0xff
   \   00004D   7B..         MOV     R3,#(`?<Constant "Light">` >> 8) & 0xff
   \   00004F   12....       LCALL   ??HalLcdWriteString?relay
    220          #endif
    221          
    222            ZDO_RegisterForZDOMsg( Light_TaskID, End_Device_Bind_rsp );
   \   000052                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000052   7A20         MOV     R2,#0x20
   \   000054   7B80         MOV     R3,#-0x80
   \   000056   90....       MOV     DPTR,#Light_TaskID
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F9           MOV     R1,A
   \   00005B   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    223            ZDO_RegisterForZDOMsg( Light_TaskID, Match_Desc_rsp );
   \   00005E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00005E   7A06         MOV     R2,#0x6
   \   000060   7B80         MOV     R3,#-0x80
   \   000062   90....       MOV     DPTR,#Light_TaskID
   \   000065   E0           MOVX    A,@DPTR
   \   000066   F9           MOV     R1,A
   \   000067   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    224          
    225          #if defined( IAR_ARMCM3_LM )
    226            // Register this task with RTOS task initiator
    227            RTOS_RegisterApp( task_id, LIGHT_RTOS_MSG_EVT );
    228          #endif
    229          }
   \   00006A                REQUIRE ?Subroutine0
   \   00006A                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    230          
    231          /*********************************************************************
    232           * @fn      Light_ProcessEvent
    233           *
    234           * @brief   Generic Application Task event processor.  This function
    235           *          is called to process all events for the task.  Events
    236           *          include timers, messages and any other user defined events.
    237           *
    238           * @param   task_id  - The OSAL assigned task ID.
    239           * @param   events - events to process.  This is a bit map and can
    240           *                   contain more than one event.
    241           *
    242           * @return  none
    243           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    244          uint16 Light_ProcessEvent( uint8 task_id, uint16 events )
   \                     Light_ProcessEvent:
    245          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 24
   \   000005   74E8         MOV     A,#-0x18
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 4,R2
   \   00000C   8B..         MOV     ?V0 + 5,R3
    246            afIncomingMSGPacket_t *MSGpkt;
    247            afDataConfirm_t *afDataConfirm;
    248          
    249            // Data Confirmation message fields
    250            byte sentEP;
    251            ZStatus_t sentStatus;
    252            byte sentTransID;       // This should match the value sent
    253            (void)task_id;  // Intentionally unreferenced parameter
    254          
    255            if ( events & SYS_EVENT_MSG )
   \   00000E   EB           MOV     A,R3
   \   00000F   5480         ANL     A,#0x80
   \   000011   7003         JNZ     $+5
   \   000013   02....       LJMP    ??Light_ProcessEvent_0 & 0xFFFF
    256            {
    257              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( Light_TaskID );
   \   000016                ; Setup parameters for call to function osal_msg_receive
   \   000016   801E         SJMP    ??Light_ProcessEvent_1
    258              while ( MSGpkt )
    259              {
    260                switch ( MSGpkt->hdr.event )
    261                {
    262                  case ZDO_CB_MSG:
    263                    Light_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    264                    break;
    265          
    266                  case KEY_CHANGE:
    267                    Light_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    268                    break;
    269          
    270                  case AF_DATA_CONFIRM_CMD:
    271                    // This message is received as a confirmation of a data packet sent.
    272                    // The status is of ZStatus_t type [defined in ZComDef.h]
    273                    // The message fields are defined in AF.h
    274                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    275                    sentEP = afDataConfirm->endpoint;
    276                    sentStatus = afDataConfirm->hdr.status;
    277                    sentTransID = afDataConfirm->transID;
    278                    (void)sentEP;
    279                    (void)sentTransID;
    280          
    281                    // Action taken when confirmation is received.
    282                    if ( sentStatus != ZSuccess )
    283                    {
    284                      // The data wasn't delivered -- Do something
    285                    }
    286                    break;
    287          
    288                  case AF_INCOMING_MSG_CMD:
    289                    Light_MessageMSGCB( MSGpkt );
    290                    break;
    291          
    292                  case ZDO_STATE_CHANGE:
    293                    Light_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??Light_ProcessEvent_2:
   \   000018   A3           INC     DPTR
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   90....       MOV     DPTR,#Light_NwkState
   \   00001D   F0           MOVX    @DPTR,A
    294                    if ( (Light_NwkState == DEV_ZB_COORD)
    295                        || (Light_NwkState == DEV_ROUTER)
    296                        || (Light_NwkState == DEV_END_DEVICE) )
   \   00001E   6409         XRL     A,#0x9
   \   000020   600A         JZ      ??Light_ProcessEvent_3
   \   000022   E0           MOVX    A,@DPTR
   \   000023   6407         XRL     A,#0x7
   \   000025   6005         JZ      ??Light_ProcessEvent_3
   \   000027   E0           MOVX    A,@DPTR
   \   000028   6406         XRL     A,#0x6
   \   00002A   7003         JNZ     ??CrossCallReturnLabel_2
    297                    {
    298                      // Start sending "the" message in a regular interval.
    299                      osal_start_timerEx( Light_TaskID,
    300                                          LIGHT_SEND_MSG_EVT,
    301                                          LIGHT_SEND_MSG_TIMEOUT );
   \                     ??Light_ProcessEvent_3:
   \   00002C                ; Setup parameters for call to function osal_start_timerEx
   \   00002C   12....       LCALL   ?Subroutine2 & 0xFFFF
    302                    }
    303                    break;
    304          
    305                  default:
    306                    break;
    307                }
    308          
    309                // Release the memory
    310                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??CrossCallReturnLabel_2:
   \   00002F                ; Setup parameters for call to function osal_msg_deallocate
   \   00002F   EE           MOV     A,R6
   \   000030   FA           MOV     R2,A
   \   000031   EF           MOV     A,R7
   \   000032   FB           MOV     R3,A
   \   000033   12....       LCALL   ??osal_msg_deallocate?relay
    311          
    312                // Next
    313                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( Light_TaskID );
   \   000036                ; Setup parameters for call to function osal_msg_receive
   \                     ??Light_ProcessEvent_1:
   \   000036   90....       MOV     DPTR,#Light_TaskID
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   F9           MOV     R1,A
   \   00003B   12....       LCALL   ??osal_msg_receive?relay
   \   00003E   8A..         MOV     ?V0 + 0,R2
   \   000040   8B..         MOV     ?V0 + 1,R3
   \   000042   AE..         MOV     R6,?V0 + 0
   \   000044   AF..         MOV     R7,?V0 + 1
   \   000046   EE           MOV     A,R6
   \   000047   4F           ORL     A,R7
   \   000048   7003         JNZ     $+5
   \   00004A   02....       LJMP    ??Light_ProcessEvent_4 & 0xFFFF
   \   00004D   8E82         MOV     DPL,R6
   \   00004F   8F83         MOV     DPH,R7
   \   000051   E0           MOVX    A,@DPTR
   \   000052   24E6         ADD     A,#-0x1a
   \   000054   7003         JNZ     $+5
   \   000056   02....       LJMP    ??Light_ProcessEvent_5 & 0xFFFF
   \   000059   245A         ADD     A,#0x5a
   \   00005B   7003         JNZ     $+5
   \   00005D   02....       LJMP    ??Light_ProcessEvent_6 & 0xFFFF
   \   000060   24EF         ADD     A,#-0x11
   \   000062   60B4         JZ      ??Light_ProcessEvent_2
   \   000064   24FE         ADD     A,#-0x2
   \   000066   70C7         JNZ     ??CrossCallReturnLabel_2
   \   000068   EE           MOV     A,R6
   \   000069   240C         ADD     A,#0xc
   \   00006B   F582         MOV     DPL,A
   \   00006D   EF           MOV     A,R7
   \   00006E   3400         ADDC    A,#0x0
   \   000070   F583         MOV     DPH,A
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F5..         MOV     ?V0 + 0,A
   \   000075   A3           INC     DPTR
   \   000076   E0           MOVX    A,@DPTR
   \   000077   F5..         MOV     ?V0 + 1,A
   \   000079   78..         MOV     R0,#?V0 + 0
   \   00007B   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for Light_ProcessEvent>_0`:
   \   00007E   0000         DW        0
   \   000080   0200         DW        2
   \   000082   0680         DW        32774
   \   000084   ....         DW        ??Light_ProcessEvent_7
   \   000086   2080         DW        32800
   \   000088   ....         DW        ??Light_ProcessEvent_8
   \   00008A   ....         DW        ??CrossCallReturnLabel_2
   \                     ??Light_ProcessEvent_7:
   \   00008C                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   00008C   EE           MOV     A,R6
   \   00008D   FA           MOV     R2,A
   \   00008E   EF           MOV     A,R7
   \   00008F   FB           MOV     R3,A
   \   000090   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000093   8A..         MOV     ?V0 + 0,R2
   \   000095   8B..         MOV     ?V0 + 1,R3
   \   000097   EA           MOV     A,R2
   \   000098   45..         ORL     A,?V0 + 1
   \   00009A   6093         JZ      ??CrossCallReturnLabel_2
   \   00009C   8A82         MOV     DPL,R2
   \   00009E   8B83         MOV     DPH,R3
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   7032         JNZ     ??Light_ProcessEvent_9
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   A3           INC     DPTR
   \   0000A6   E0           MOVX    A,@DPTR
   \   0000A7   602C         JZ      ??Light_ProcessEvent_9
   \   0000A9   90....       MOV     DPTR,#Light_DstAddr + 8
   \   0000AC   7402         MOV     A,#0x2
   \   0000AE   F0           MOVX    @DPTR,A
   \   0000AF   8A82         MOV     DPL,R2
   \   0000B1   8B83         MOV     DPH,R3
   \   0000B3   A3           INC     DPTR
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F8           MOV     R0,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   F9           MOV     R1,A
   \   0000B9   90....       MOV     DPTR,#Light_DstAddr
   \   0000BC   E8           MOV     A,R0
   \   0000BD   F0           MOVX    @DPTR,A
   \   0000BE   A3           INC     DPTR
   \   0000BF   E9           MOV     A,R1
   \   0000C0   F0           MOVX    @DPTR,A
   \   0000C1   8A82         MOV     DPL,R2
   \   0000C3   8B83         MOV     DPH,R3
   \   0000C5   A3           INC     DPTR
   \   0000C6   A3           INC     DPTR
   \   0000C7   A3           INC     DPTR
   \   0000C8   A3           INC     DPTR
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   90....       MOV     DPTR,#Light_DstAddr + 9
   \   0000CD   F0           MOVX    @DPTR,A
   \   0000CE                ; Setup parameters for call to function HalLedSet
   \   0000CE   7A01         MOV     R2,#0x1
   \   0000D0   7908         MOV     R1,#0x8
   \   0000D2   12....       LCALL   ??HalLedSet?relay
   \                     ??Light_ProcessEvent_9:
   \   0000D5                ; Setup parameters for call to function osal_mem_free
   \   0000D5   AA..         MOV     R2,?V0 + 0
   \   0000D7   AB..         MOV     R3,?V0 + 1
   \   0000D9   12....       LCALL   ??osal_mem_free?relay
   \   0000DC   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \                     ??Light_ProcessEvent_8:
   \   0000DF   EE           MOV     A,R6
   \   0000E0   2413         ADD     A,#0x13
   \   0000E2   F582         MOV     DPL,A
   \   0000E4   EF           MOV     A,R7
   \   0000E5   3400         ADDC    A,#0x0
   \   0000E7   F583         MOV     DPH,A
   \   0000E9   E0           MOVX    A,@DPTR
   \   0000EA   F8           MOV     R0,A
   \   0000EB   A3           INC     DPTR
   \   0000EC   E0           MOVX    A,@DPTR
   \   0000ED   F583         MOV     DPH,A
   \   0000EF   8882         MOV     DPL,R0
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   700A         JNZ     ??Light_ProcessEvent_10
   \   0000F4                ; Setup parameters for call to function HalLedSet
   \   0000F4   7A01         MOV     R2,#0x1
   \                     ??Light_ProcessEvent_11:
   \   0000F6   7908         MOV     R1,#0x8
   \   0000F8   12....       LCALL   ??HalLedSet?relay
   \   0000FB   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \                     ??Light_ProcessEvent_10:
   \   0000FE                ; Setup parameters for call to function HalLedSet
   \   0000FE   7A04         MOV     R2,#0x4
   \   000100   80F4         SJMP    ??Light_ProcessEvent_11
   \                     ??Light_ProcessEvent_6:
   \   000102   A3           INC     DPTR
   \   000103   A3           INC     DPTR
   \   000104   A3           INC     DPTR
   \   000105   E0           MOVX    A,@DPTR
   \   000106   F5..         MOV     ?V0 + 2,A
   \   000108   8E82         MOV     DPL,R6
   \   00010A   8F83         MOV     DPH,R7
   \   00010C   A3           INC     DPTR
   \   00010D   A3           INC     DPTR
   \   00010E   E0           MOVX    A,@DPTR
   \   00010F   6003         JZ      $+5
   \   000111   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \   000114   E5..         MOV     A,?V0 + 2
   \   000116   A2E1         MOV     C,0xE0 /* A   */.1
   \   000118   506D         JNC     ??Light_ProcessEvent_12
   \   00011A                ; Setup parameters for call to function HalLedSet
   \   00011A   7A00         MOV     R2,#0x0
   \   00011C   7908         MOV     R1,#0x8
   \   00011E   12....       LCALL   ??HalLedSet?relay
   \   000121   7408         MOV     A,#0x8
   \   000123   12....       LCALL   ?XSTACK_DISP0_8
   \   000126   7402         MOV     A,#0x2
   \   000128   F0           MOVX    @DPTR,A
   \   000129   85..82       MOV     DPL,?XSP + 0
   \   00012C   85..83       MOV     DPH,?XSP + 1
   \   00012F   E4           CLR     A
   \   000130   F0           MOVX    @DPTR,A
   \   000131   A3           INC     DPTR
   \   000132   F0           MOVX    @DPTR,A
   \   000133                ; Setup parameters for call to function NLME_GetShortAddr
   \   000133   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000136   8A..         MOV     ?V0 + 0,R2
   \   000138   8B..         MOV     ?V0 + 1,R3
   \   00013A   AC..         MOV     R4,?V0 + 0
   \   00013C   AD..         MOV     R5,?V0 + 1
   \   00013E   75....       MOV     ?V0 + 0,#Light_ClusterList & 0xff
   \   000141   75....       MOV     ?V0 + 1,#(Light_ClusterList >> 8) & 0xff
   \   000144                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000144   75..00       MOV     ?V0 + 3,#0x0
   \   000147   78..         MOV     R0,#?V0 + 3
   \   000149   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00014C   78..         MOV     R0,#?V0 + 0
   \   00014E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000151   75..01       MOV     ?V0 + 3,#0x1
   \   000154   78..         MOV     R0,#?V0 + 3
   \   000156   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000159   78..         MOV     R0,#?V0 + 0
   \   00015B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00015E   75..01       MOV     ?V0 + 0,#0x1
   \   000161   78..         MOV     R0,#?V0 + 0
   \   000163   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000166   75..04       MOV     ?V0 + 0,#0x4
   \   000169   75..0F       MOV     ?V0 + 1,#0xf
   \   00016C   78..         MOV     R0,#?V0 + 0
   \   00016E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000171   90....       MOV     DPTR,#Light_epDesc
   \   000174   E0           MOVX    A,@DPTR
   \   000175   F9           MOV     R1,A
   \   000176   7409         MOV     A,#0x9
   \   000178   12....       LCALL   ?XSTACK_DISP0_8
   \   00017B   AA82         MOV     R2,DPL
   \   00017D   AB83         MOV     R3,DPH
   \   00017F   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000182   7409         MOV     A,#0x9
   \   000184   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??Light_ProcessEvent_12:
   \   000187   E5..         MOV     A,?V0 + 2
   \   000189   A2E3         MOV     C,0xE0 /* A   */.3
   \   00018B   4003         JC      $+5
   \   00018D   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \   000190                ; Setup parameters for call to function HalLedSet
   \   000190   7A00         MOV     R2,#0x0
   \   000192   7908         MOV     R1,#0x8
   \   000194   12....       LCALL   ??HalLedSet?relay
   \   000197   7408         MOV     A,#0x8
   \   000199   12....       LCALL   ?XSTACK_DISP0_8
   \   00019C   740F         MOV     A,#0xf
   \   00019E   F0           MOVX    @DPTR,A
   \   00019F   85..82       MOV     DPL,?XSP + 0
   \   0001A2   85..83       MOV     DPH,?XSP + 1
   \   0001A5   74FF         MOV     A,#-0x1
   \   0001A7   F0           MOVX    @DPTR,A
   \   0001A8   A3           INC     DPTR
   \   0001A9   F0           MOVX    @DPTR,A
   \   0001AA   75....       MOV     ?V0 + 0,#Light_ClusterList & 0xff
   \   0001AD   75....       MOV     ?V0 + 1,#(Light_ClusterList >> 8) & 0xff
   \   0001B0                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0001B0   75..00       MOV     ?V0 + 2,#0x0
   \   0001B3   78..         MOV     R0,#?V0 + 2
   \   0001B5   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001B8   78..         MOV     R0,#?V0 + 0
   \   0001BA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001BD   75..01       MOV     ?V0 + 2,#0x1
   \   0001C0   78..         MOV     R0,#?V0 + 2
   \   0001C2   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001C5   78..         MOV     R0,#?V0 + 0
   \   0001C7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001CA   75..04       MOV     ?V0 + 0,#0x4
   \   0001CD   75..0F       MOV     ?V0 + 1,#0xf
   \   0001D0   78..         MOV     R0,#?V0 + 0
   \   0001D2   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001D5   7901         MOV     R1,#0x1
   \   0001D7   7CFF         MOV     R4,#-0x1
   \   0001D9   7DFF         MOV     R5,#-0x1
   \   0001DB   7408         MOV     A,#0x8
   \   0001DD   12....       LCALL   ?XSTACK_DISP0_8
   \   0001E0   AA82         MOV     R2,DPL
   \   0001E2   AB83         MOV     R3,DPH
   \   0001E4   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0001E7   7408         MOV     A,#0x8
   \   0001E9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001EC   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \                     ??Light_ProcessEvent_5:
   \   0001EF   A3           INC     DPTR
   \   0001F0   A3           INC     DPTR
   \   0001F1   A3           INC     DPTR
   \   0001F2   A3           INC     DPTR
   \   0001F3   E0           MOVX    A,@DPTR
   \   0001F4   6401         XRL     A,#0x1
   \   0001F6   7002         JNZ     ??Light_ProcessEvent_13
   \   0001F8   A3           INC     DPTR
   \   0001F9   E0           MOVX    A,@DPTR
   \                     ??Light_ProcessEvent_13:
   \   0001FA   6003         JZ      $+5
   \   0001FC   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
   \   0001FF                ; Setup parameters for call to function HalLcdWriteScreen
   \   0001FF   7C..         MOV     R4,#`?<Constant "rcvd">` & 0xff
   \   000201   7D..         MOV     R5,#(`?<Constant "rcvd">` >> 8) & 0xff
   \   000203   EE           MOV     A,R6
   \   000204   2422         ADD     A,#0x22
   \   000206   F582         MOV     DPL,A
   \   000208   EF           MOV     A,R7
   \   000209   3400         ADDC    A,#0x0
   \   00020B   F583         MOV     DPH,A
   \   00020D   E0           MOVX    A,@DPTR
   \   00020E   FA           MOV     R2,A
   \   00020F   A3           INC     DPTR
   \   000210   E0           MOVX    A,@DPTR
   \   000211   FB           MOV     R3,A
   \   000212   12....       LCALL   ??HalLcdWriteScreen?relay
   \   000215   02....       LJMP    ??CrossCallReturnLabel_2 & 0xFFFF
    314              }
    315          
    316              // return unprocessed events
    317              return (events ^ SYS_EVENT_MSG);
   \                     ??Light_ProcessEvent_4:
   \   000218   AA..         MOV     R2,?V0 + 4
   \   00021A   E5..         MOV     A,?V0 + 5
   \   00021C   6480         XRL     A,#0x80
   \   00021E   FB           MOV     R3,A
   \   00021F   02....       LJMP    ??Light_ProcessEvent_14 & 0xFFFF
    318            }
    319          
    320            // Send a message out - This event is generated by a timer
    321            //  (setup in Light_Init()).
    322            if ( events & LIGHT_SEND_MSG_EVT )
   \                     ??Light_ProcessEvent_0:
   \   000222   EA           MOV     A,R2
   \   000223   A2E0         MOV     C,0xE0 /* A   */.0
   \   000225   4003         JC      $+5
   \   000227   02....       LJMP    ??Light_ProcessEvent_15 & 0xFFFF
    323            {
    324              // Send "the" message
    325              Light_SendTheMessage();
   \   00022A   7409         MOV     A,#0x9
   \   00022C   12....       LCALL   ?XSTACK_DISP0_8
   \   00022F   AC82         MOV     R4,DPL
   \   000231   AD83         MOV     R5,DPH
   \   000233   7583..       MOV     DPH,#(`?<Constant "LIGHT:">` >> 8) & 0xff
   \   000236   7582..       MOV     DPL,#`?<Constant "LIGHT:">` & 0xff
   \   000239   740F         MOV     A,#0xf
   \   00023B   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
   \   00023E                ; Setup parameters for call to function _ltoa
   \   00023E   740F         MOV     A,#0xf
   \   000240   12....       LCALL   ?XSTACK_DISP0_8
   \   000243   8582..       MOV     ?V0 + 0,DPL
   \   000246   8583..       MOV     ?V0 + 1,DPH
   \   000249   78..         MOV     R0,#?V0 + 0
   \   00024B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00024E   790A         MOV     R1,#0xa
   \   000250   90....       MOV     DPTR,#fLight
   \   000253   12....       LCALL   ?XLOAD_R2345
   \   000256   12....       LCALL   ?R2345_FLT_TO_UL
   \   000259   AA..         MOV     R2,?V0 + 0
   \   00025B   AB..         MOV     R3,?V0 + 1
   \   00025D   AC..         MOV     R4,?V0 + 2
   \   00025F   AD..         MOV     R5,?V0 + 3
   \   000261   12....       LCALL   ??_ltoa?relay
   \   000264   7402         MOV     A,#0x2
   \   000266   12....       LCALL   ?DEALLOC_XSTACK8
   \   000269   7800         MOV     R0,#0x0
   \                     ??Light_ProcessEvent_16:
   \   00026B   88..         MOV     ?V0 + 0,R0
   \   00026D   7409         MOV     A,#0x9
   \   00026F   12....       LCALL   ?XSTACK_DISP0_8
   \   000272   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000275   E0           MOVX    A,@DPTR
   \   000276   700B         JNZ     ??Light_ProcessEvent_17
   \   000278   7409         MOV     A,#0x9
   \   00027A   12....       LCALL   ?XSTACK_DISP0_8
   \   00027D   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000280   7420         MOV     A,#0x20
   \   000282   F0           MOVX    @DPTR,A
   \                     ??Light_ProcessEvent_17:
   \   000283   08           INC     R0
   \   000284   E8           MOV     A,R0
   \   000285   C3           CLR     C
   \   000286   940E         SUBB    A,#0xe
   \   000288   40E1         JC      ??Light_ProcessEvent_16
   \   00028A                ; Setup parameters for call to function AF_DataRequest
   \   00028A   75..1E       MOV     ?V0 + 0,#0x1e
   \   00028D   78..         MOV     R0,#?V0 + 0
   \   00028F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000292   75....       MOV     ?V0 + 0,#Light_TransID & 0xff
   \   000295   75....       MOV     ?V0 + 1,#(Light_TransID >> 8) & 0xff
   \   000298   78..         MOV     R0,#?V0 + 0
   \   00029A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00029D   740C         MOV     A,#0xc
   \   00029F   12....       LCALL   ?XSTACK_DISP0_8
   \   0002A2   8582..       MOV     ?V0 + 0,DPL
   \   0002A5   8583..       MOV     ?V0 + 1,DPH
   \   0002A8   78..         MOV     R0,#?V0 + 0
   \   0002AA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002AD                ; Setup parameters for call to function osal_strlen
   \   0002AD   740E         MOV     A,#0xe
   \   0002AF   12....       LCALL   ?XSTACK_DISP0_8
   \   0002B2   AA82         MOV     R2,DPL
   \   0002B4   AB83         MOV     R3,DPH
   \   0002B6   12....       LCALL   ??osal_strlen?relay
   \   0002B9   EA           MOV     A,R2
   \   0002BA   2401         ADD     A,#0x1
   \   0002BC   F5..         MOV     ?V0 + 0,A
   \   0002BE   E4           CLR     A
   \   0002BF   3400         ADDC    A,#0x0
   \   0002C1   F5..         MOV     ?V0 + 1,A
   \   0002C3   78..         MOV     R0,#?V0 + 0
   \   0002C5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002C8   75..01       MOV     ?V0 + 0,#0x1
   \   0002CB   75..00       MOV     ?V0 + 1,#0x0
   \   0002CE   78..         MOV     R0,#?V0 + 0
   \   0002D0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002D3   7920         MOV     R1,#0x20
   \   0002D5   7C..         MOV     R4,#Light_epDesc & 0xff
   \   0002D7   7D..         MOV     R5,#(Light_epDesc >> 8) & 0xff
   \   0002D9   7A..         MOV     R2,#Light_DstAddr & 0xff
   \   0002DB   7B..         MOV     R3,#(Light_DstAddr >> 8) & 0xff
   \   0002DD   12....       LCALL   ??AF_DataRequest?relay
   \   0002E0   7409         MOV     A,#0x9
   \   0002E2   12....       LCALL   ?DEALLOC_XSTACK8
    326          
    327              // Setup to send message again
    328              osal_start_timerEx( Light_TaskID,
    329                                  LIGHT_SEND_MSG_EVT,
    330                                  LIGHT_SEND_MSG_TIMEOUT );
   \   0002E5                ; Setup parameters for call to function osal_start_timerEx
   \   0002E5   12....       LCALL   ?Subroutine2 & 0xFFFF
    331          
    332              // return unprocessed events
    333              return (events ^ LIGHT_SEND_MSG_EVT);
   \                     ??CrossCallReturnLabel_3:
   \   0002E8   E5..         MOV     A,?V0 + 4
   \   0002EA   6401         XRL     A,#0x1
   \   0002EC   FA           MOV     R2,A
   \   0002ED   AB..         MOV     R3,?V0 + 5
   \   0002EF   8004         SJMP    ??Light_ProcessEvent_14
    334            }
    335          
    336            
    337          #if defined( IAR_ARMCM3_LM )
    338            // Receive a message from the RTOS queue
    339            if ( events & LIGHT_RTOS_MSG_EVT )
    340            {
    341              // Process message from RTOS queue
    342              Light_ProcessRtosMessage();
    343          
    344              // return unprocessed events
    345              return (events ^ LIGHT_RTOS_MSG_EVT);
    346            }
    347          #endif
    348          
    349            // Discard unknown events
    350            return 0;
   \                     ??Light_ProcessEvent_15:
   \   0002F1   7A00         MOV     R2,#0x0
   \   0002F3   7B00         MOV     R3,#0x0
   \                     ??Light_ProcessEvent_14:
   \   0002F5   7418         MOV     A,#0x18
   \   0002F7   12....       LCALL   ?DEALLOC_XSTACK8
   \   0002FA   7F06         MOV     R7,#0x6
   \   0002FC   02....       LJMP    ?BANKED_LEAVE_XDATA
    351          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7C88         MOV     R4,#-0x78
   \   000002   7D13         MOV     R5,#0x13
   \   000004   7A01         MOV     R2,#0x1
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#Light_TaskID
   \   00000B                REQUIRE ??Subroutine3_0
   \   00000B                ; // Fall through to label ??Subroutine3_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine3_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F9           MOV     R1,A
   \   000002   12....       LCALL   ??osal_start_timerEx?relay
   \   000005   22           RET
    352          
    353          /*********************************************************************
    354           * Event Generation Functions
    355           */
    356          
    357          /*********************************************************************
    358           * @fn      Light_ProcessZDOMsgs()
    359           *
    360           * @brief   Process response messages
    361           *
    362           * @param   none
    363           *
    364           * @return  none
    365           */
    366          static void Light_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    367          {
    368            switch ( inMsg->clusterID )
    369            {
    370              case End_Device_Bind_rsp:
    371                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    372                {
    373                  // Light LED
    374                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    375                }
    376          #if defined( BLINK_LEDS )
    377                else
    378                {
    379                  // Flash LED to show failure
    380                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
    381                }
    382          #endif
    383                break;
    384          
    385              case Match_Desc_rsp:
    386                {
    387                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    388                  if ( pRsp )
    389                  {
    390                    if ( pRsp->status == ZSuccess && pRsp->cnt )
    391                    {
    392                      Light_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
    393                      Light_DstAddr.addr.shortAddr = pRsp->nwkAddr;
    394                      // Take the first endpoint, Can be changed to search through endpoints
    395                      Light_DstAddr.endPoint = pRsp->epList[0];
    396          
    397                      // Light LED
    398                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    399                    }
    400                    osal_mem_free( pRsp );
    401                  }
    402                }
    403                break;
    404            }
    405          }
    406          
    407          /*********************************************************************
    408           * @fn      Light_HandleKeys
    409           *
    410           * @brief   Handles all key events for this device.
    411           *
    412           * @param   shift - true if in shift/alt.
    413           * @param   keys - bit field for key events. Valid entries:
    414           *                 HAL_KEY_SW_4
    415           *                 HAL_KEY_SW_3
    416           *                 HAL_KEY_SW_2
    417           *                 HAL_KEY_SW_1
    418           *
    419           * @return  none
    420           */
    421          static void Light_HandleKeys( uint8 shift, uint8 keys )
    422          {
    423            zAddrType_t dstAddr;
    424          
    425            // Shift is used to make each button/switch dual purpose.
    426            if ( shift )
    427            {
    428              if ( keys & HAL_KEY_SW_1 )
    429              {
    430              }
    431              if ( keys & HAL_KEY_SW_2 )
    432              {
    433              }
    434              if ( keys & HAL_KEY_SW_3 )
    435              {
    436              }
    437              if ( keys & HAL_KEY_SW_4 )
    438              {
    439              }
    440            }
    441            else
    442            {
    443              if ( keys & HAL_KEY_SW_1 )
    444              {
    445                // Since SW1 isn't used for anything else in this application...
    446          #if defined( SWITCH1_BIND )
    447                // we can use SW1 to simulate SW2 for devices that only have one switch,
    448                keys |= HAL_KEY_SW_2;
    449          #elif defined( SWITCH1_MATCH )
    450                // or use SW1 to simulate SW4 for devices that only have one switch
    451                keys |= HAL_KEY_SW_4;
    452          #endif
    453              }
    454          
    455              if ( keys & HAL_KEY_SW_2 )
    456              {
    457                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    458          
    459                // Initiate an End Device Bind Request for the mandatory endpoint
    460                dstAddr.addrMode = Addr16Bit;
    461                dstAddr.addr.shortAddr = 0x0000; // Coordinator
    462                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    463                                      Light_epDesc.endPoint,
    464                                      LIGHT_PROFID,
    465                                      LIGHT_MAX_CLUSTERS, (cId_t *)Light_ClusterList,
    466                                      LIGHT_MAX_CLUSTERS, (cId_t *)Light_ClusterList,
    467                                      FALSE );
    468              }
    469          
    470              if ( keys & HAL_KEY_SW_3 )
    471              {
    472              }
    473          
    474              if ( keys & HAL_KEY_SW_4 )
    475              {
    476                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    477                // Initiate a Match Description Request (Service Discovery)
    478                dstAddr.addrMode = AddrBroadcast;
    479                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    480                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    481                                  LIGHT_PROFID,
    482                                  LIGHT_MAX_CLUSTERS, (cId_t *)Light_ClusterList,
    483                                  LIGHT_MAX_CLUSTERS, (cId_t *)Light_ClusterList,
    484                                  FALSE );
    485              }
    486            }
    487          }
    488          
    489          /*********************************************************************
    490           * LOCAL FUNCTIONS
    491           */
    492          
    493          /*********************************************************************
    494           * @fn      Light_MessageMSGCB
    495           *
    496           * @brief   Data message processor callback.  This function processes
    497           *          any incoming data - probably from other devices.  So, based
    498           *          on cluster ID, perform the intended action.
    499           *
    500           * @param   none
    501           *
    502           * @return  none
    503           */
    504          static void Light_MessageMSGCB( afIncomingMSGPacket_t *pkt )
    505          {
    506            switch ( pkt->clusterId )
    507            {
    508              case LIGHT_CLUSTERID:
    509                // "the" message
    510          #if defined( LCD_SUPPORTED )
    511                HalLcdWriteScreen( (char*)pkt->cmd.Data, "rcvd" );
    512          #elif defined( WIN32 )
    513                WPRINTSTR( pkt->cmd.Data );
    514          #endif
    515                break;
    516            }
    517          }
    518          
    519          /*********************************************************************
    520           * @fn      Light_SendTheMessage
    521           *
    522           * @brief   Send "the" message.
    523           *
    524           * @param   none
    525           *
    526           * @return  none
    527           */
    528          static void Light_SendTheMessage( void )
    529          {
    530            unsigned char theMessageData[15] = "LIGHT:";
    531            
    532            _ltoa( (uint32)(fLight), &theMessageData[6], 10 );
    533            
    534            for (unsigned char i=0; i<15-1; i++)
    535            {
    536              if (theMessageData[i] == 0x00 )
    537              {
    538                theMessageData[i] = ' ';
    539              }
    540            }
    541          
    542            if ( AF_DataRequest( &Light_DstAddr, &Light_epDesc,
    543                                 LIGHT_CLUSTERID,
    544                                 (byte)osal_strlen( theMessageData ) + 1,
                                                           ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char *"
    545                                 (byte *)&theMessageData,
    546                                 &Light_TransID,
    547                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    548            {
    549              // Successfully requested to be sent.
    550            }
    551            else
    552            {
    553              // Error occurred in request to send.
    554            }
    555          }
    556          
    557          #if defined( IAR_ARMCM3_LM )
    558          /*********************************************************************
    559           * @fn      Light_ProcessRtosMessage
    560           *
    561           * @brief   Receive message from RTOS queue, send response back.
    562           *
    563           * @param   none
    564           *
    565           * @return  none
    566           */
    567          static void Light_ProcessRtosMessage( void )
    568          {
    569            osalQueue_t inMsg;
    570          
    571            if ( osal_queue_receive( OsalQueue, &inMsg, 0 ) == pdPASS )
    572            {
    573              uint8 cmndId = inMsg.cmnd;
    574              uint32 counter = osal_build_uint32( inMsg.cbuf, 4 );
    575          
    576              switch ( cmndId )
    577              {
    578                case CMD_INCR:
    579                  counter += 1;  /* Increment the incoming counter */
    580                                 /* Intentionally fall through next case */
    581          
    582                case CMD_ECHO:
    583                {
    584                  userQueue_t outMsg;
    585          
    586                  outMsg.resp = RSP_CODE | cmndId;  /* Response ID */
    587                  osal_buffer_uint32( outMsg.rbuf, counter );    /* Increment counter */
    588                  osal_queue_send( UserQueue1, &outMsg, 0 );  /* Send back to UserTask */
    589                  break;
    590                }
    591                
    592                default:
    593                  break;  /* Ignore unknown command */    
    594              }
    595            }
    596          }
    597          
    598          #endif
    599          
    600          //***********************************************************************************
    601          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    602          uint16 LightMeasurement_ProcessEvent( uint8 task_id, uint16 events )
   \                     LightMeasurement_ProcessEvent:
    603          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    604            if ( events & LINGHTMEASUREMENT_EVT )
   \   000009   EE           MOV     A,R6
   \   00000A   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000C   506B         JNC     ??LightMeasurement_ProcessEvent_0
    605            {
    606            osal_start_timerEx( LightMeasurement_TaskID,
    607                                  LINGHTMEASUREMENT_EVT,
    608                                  LINGHTMEASUREMENT_TIMEOUT );
   \   00000E                ; Setup parameters for call to function osal_start_timerEx
   \   00000E   7CA0         MOV     R4,#-0x60
   \   000010   7D0F         MOV     R5,#0xf
   \   000012   7A01         MOV     R2,#0x1
   \   000014   7B00         MOV     R3,#0x0
   \   000016   90....       MOV     DPTR,#LightMeasurement_TaskID
   \   000019   12....       LCALL   ??Subroutine3_0 & 0xFFFF
    609          
    610              Init_BH1750();       //³õÊ¼»¯BH1750
   \                     ??CrossCallReturnLabel_4:
   \   00001C                ; Setup parameters for call to function Init_BH1750
   \   00001C   12....       LCALL   ??Init_BH1750?relay
    611              Single_Write_BH1750(0x02);   // power on
   \   00001F                ; Setup parameters for call to function Single_Write_BH1750
   \   00001F   7902         MOV     R1,#0x2
   \   000021   12....       LCALL   ??Single_Write_BH1750?relay
    612              Single_Write_BH1750(0x10);   // H- resolution mode
   \   000024                ; Setup parameters for call to function Single_Write_BH1750
   \   000024   7910         MOV     R1,#0x10
   \   000026   12....       LCALL   ??Single_Write_BH1750?relay
    613          
    614              delay_nms(180);              //ÑÓÊ±180ms
   \   000029                ; Setup parameters for call to function delay_nms
   \   000029   7AB4         MOV     R2,#-0x4c
   \   00002B   7B00         MOV     R3,#0x0
   \   00002D   12....       LCALL   ??delay_nms?relay
    615              Multiple_Read();       //Á¬Ðø¶Á³öÊý¾Ý£¬´æ´¢ÔÚBUFÖÐ
   \   000030                ; Setup parameters for call to function Multiple_Read
   \   000030   12....       LCALL   ??Multiple_Read?relay
    616          
    617              dis_data=BUF[0];
    618              dis_data=(dis_data<<8)+BUF[1];//ºÏ³ÉÊý¾Ý£¬¼´¹âÕÕÊý¾Ý
   \   000033   90....       MOV     DPTR,#BUF
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F9           MOV     R1,A
   \   000038   A3           INC     DPTR
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   FA           MOV     R2,A
   \   00003B   E4           CLR     A
   \   00003C   2A           ADD     A,R2
   \   00003D   90....       MOV     DPTR,#dis_data
   \   000040   F0           MOVX    @DPTR,A
   \   000041   A3           INC     DPTR
   \   000042   E9           MOV     A,R1
   \   000043   F0           MOVX    @DPTR,A
    619          
    620              fLight = (float)dis_data/1.5;
   \   000044   90....       MOV     DPTR,#dis_data
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F5..         MOV     ?V0 + 0,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F5..         MOV     ?V0 + 1,A
   \   00004E   33           RLC     A
   \   00004F   95E0         SUBB    A,0xE0 /* A   */
   \   000051   F5..         MOV     ?V0 + 2,A
   \   000053   F5..         MOV     ?V0 + 3,A
   \   000055   78..         MOV     R0,#?V0 + 0
   \   000057   12....       LCALL   ?L_TO_FLT
   \   00005A   90....       MOV     DPTR,#__Constant_3fc00000
   \   00005D   78..         MOV     R0,#?V0 + 4
   \   00005F   12....       LCALL   ?L_MOV_X
   \   000062   78..         MOV     R0,#?V0 + 0
   \   000064   79..         MOV     R1,#?V0 + 4
   \   000066   12....       LCALL   ?FLT_DIV
   \   000069   90....       MOV     DPTR,#fLight
   \   00006C   78..         MOV     R0,#?V0 + 0
   \   00006E   12....       LCALL   ?L_MOV_TO_X
    621              
    622              //HalLedSet ( HAL_LED_2, HAL_LED_MODE_TOGGLE );
    623          
    624              // return unprocessed events
    625              return (events ^ LINGHTMEASUREMENT_EVT);
   \   000071   EE           MOV     A,R6
   \   000072   6401         XRL     A,#0x1
   \   000074   FA           MOV     R2,A
   \   000075   EF           MOV     A,R7
   \   000076   FB           MOV     R3,A
   \   000077   8004         SJMP    ??LightMeasurement_ProcessEvent_1
    626            }
    627          
    628            // Discard unknown events
    629            return 0;
   \                     ??LightMeasurement_ProcessEvent_0:
   \   000079   7A00         MOV     R2,#0x0
   \   00007B   7B00         MOV     R3,#0x0
   \                     ??LightMeasurement_ProcessEvent_1:
   \   00007D   7F08         MOV     R7,#0x8
   \   00007F   02....       LJMP    ?BANKED_LEAVE_XDATA
    630          }
    631          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    632          void LightMeasurement_Init( uint8 task_id )
   \                     LightMeasurement_Init:
    633          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    634            LightMeasurement_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#LightMeasurement_TaskID
   \   000009   F0           MOVX    @DPTR,A
    635            LightMeasurement_TransID = 0;
   \   00000A   90....       MOV     DPTR,#LightMeasurement_TransID
   \   00000D   E4           CLR     A
   \   00000E   F0           MOVX    @DPTR,A
    636            
    637            osal_start_timerEx( LightMeasurement_TaskID,
    638                                  LINGHTMEASUREMENT_EVT,
    639                                  LINGHTMEASUREMENT_TIMEOUT );
   \   00000F                ; Setup parameters for call to function osal_start_timerEx
   \   00000F   7CA0         MOV     R4,#-0x60
   \   000011   7D0F         MOV     R5,#0xf
   \   000013   7A01         MOV     R2,#0x1
   \   000015   FB           MOV     R3,A
   \   000016   12....       LCALL   ??osal_start_timerEx?relay
    640            
    641            RegisterForKeys( LightMeasurement_TaskID );  
   \   000019                ; Setup parameters for call to function RegisterForKeys
   \   000019   90....       MOV     DPTR,#LightMeasurement_TaskID
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   12....       LCALL   ??RegisterForKeys?relay
    642          }
   \   000021   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   E582         MOV     A,DPL
   \   000002   25..         ADD     A,?V0 + 0
   \   000004   F582         MOV     DPL,A
   \   000006   E583         MOV     A,DPH
   \   000008   3400         ADDC    A,#0x0
   \   00000A   F583         MOV     DPH,A
   \   00000C   22           RET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Light_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Light_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Light_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Light_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??LightMeasurement_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    LightMeasurement_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??LightMeasurement_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    LightMeasurement_Init

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Light">`:
   \   000000   4C696768     DB "Light"
   \            7400    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "rcvd">`:
   \   000000   72637664     DB "rcvd"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "LIGHT:">`:
   \   000000   4C494748     DB "LIGHT:"
   \            543A00  
   \   000007   00000000     DB 0, 0, 0, 0, 0, 0, 0, 0
   \            00000000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3fc00000:
   \   000000   0000C03F     DD 3FC00000H
    643          
    644          
    645          /*********************************************************************
    646           */

   Maximum stack usage in bytes:

     Function                      ISTACK PSTACK XSTACK
     --------                      ------ ------ ------
     LightMeasurement_Init             0      0      9
       -> osal_start_timerEx           0      0     18
       -> RegisterForKeys              0      0     18
     LightMeasurement_ProcessEvent     0      0     16
       -> osal_start_timerEx           0      0     32
       -> Init_BH1750                  0      0     32
       -> Single_Write_BH1750          0      0     32
       -> Single_Write_BH1750          0      0     32
       -> delay_nms                    0      0     32
       -> Multiple_Read                0      0     32
     Light_Init                        0      0      9
       -> afRegister                   0      0     18
       -> RegisterForKeys              0      0     18
       -> HalLcdWriteString            0      0     18
       -> ZDO_RegisterForZDOMsg        0      0     18
       -> ZDO_RegisterForZDOMsg        0      0     18
     Light_ProcessEvent                2      0     47
       -> osal_msg_receive             0      0     76
       -> osal_start_timerEx           0      0     76
       -> osal_msg_deallocate          0      0     76
       -> osal_msg_receive             0      0     76
       -> ZDO_ParseEPListRsp           0      0     76
       -> HalLedSet                    0      0     76
       -> osal_mem_free                0      0     76
       -> HalLedSet                    0      0     76
       -> HalLedSet                    0      0     76
       -> HalLedSet                    0      0     76
       -> NLME_GetShortAddr            0      0     76
       -> ZDP_EndDeviceBindReq         0      0     94
       -> HalLedSet                    0      0     76
       -> ZDP_MatchDescReq             0      0     92
       -> HalLcdWriteScreen            0      0     76
       -> _ltoa                        0      0     80
       -> osal_strlen                  0      0     86
       -> AF_DataRequest               0      0     94
       -> osal_start_timerEx           0      0     76


   Segment part sizes:

     Function/Label                        Bytes
     --------------                        -----
     Light_ClusterList                        2
     Light_SimpleDesc                        12
     Light_epDesc                             6
     Light_TaskID                             1
     Light_NwkState                           1
     Light_TransID                            1
     Light_DstAddr                           12
     LightMeasurement_TaskID                  1
     LightMeasurement_NwkState                1
     LightMeasurement_TransID                 1
     fLight                                   4
     Light_Init                             106
     ?Subroutine0                             5
     Light_ProcessEvent                     767
     ?Subroutine2                            11
     ??Subroutine3_0                          6
     LightMeasurement_ProcessEvent          130
     LightMeasurement_Init                   36
     ?Subroutine1                            13
     ??Light_Init?relay                       6
     ??Light_ProcessEvent?relay               6
     ??LightMeasurement_ProcessEvent?relay    6
     ??LightMeasurement_Init?relay            6
     ?<Constant "Light">                      6
     ?<Constant "rcvd">                       5
     ?<Constant "LIGHT:">                    15
     __Constant_3fc00000                      4

 
 1 074 bytes in segment BANKED_CODE
    24 bytes in segment BANK_RELAYS
    44 bytes in segment XDATA_ROM_C
    28 bytes in segment XDATA_Z
 
 1 098 bytes of CODE  memory
    40 bytes of CONST memory (+ 4 bytes shared)
    28 bytes of XDATA memory

Errors: none
Warnings: 1
